(function e$$0(n,l,a){function g(c,b){if(!l[c]){if(!n[c]){var k="function"==typeof require&&require;if(!b&&k)return k(c,!0);if(m)return m(c,!0);k=Error("Cannot find module '"+c+"'");throw k.code="MODULE_NOT_FOUND",k;}k=l[c]={exports:{}};n[c][0].call(k.exports,function(a){var d=n[c][1][a];return g(d?d:a)},k,k.exports,e$$0,n,l,a)}return l[c].exports}for(var m="function"==typeof require&&require,f=0;f<a.length;f++)g(a[f]);return g})({1:[function(h,n,l){Twilio=function(a){var g=typeof a,m=!(!a||"object"!==
g&&"function"!==g||!a.constructor||"Loader"!==a.constructor.name&&!a.constructor.toString().match(/Loader/)),f=m?a:{};(function(a){for(var b in a)f[b]=a[b]})(function(){var a=h("./twilio/util");a.setLoaded(m);var b=a.getSDKVersion(),k="undefined"!=typeof k?k:function(){for(var a=location.protocol||"http:",d="//static.twilio.com/libs/twiliojs/1.0/",b=document.getElementsByTagName("script"),e=/(\w+:)?(\/\/.*)(twilio.min.js|twilio.js)/,c=0;c<b.length;c++){var q=b[c].src.match(e);if(q){a=q[1]||a;d=q[2];
break}}return a+d}();a.setTwilioRoot(k);var e=k+"WebSocket.swf";"undefined"!==typeof window&&(window.WEB_SOCKET_SWF_LOCATION=e);var e=document.createElement("audio"),d=!0;try{d=!(e.canPlayType&&(e.canPlayType("audio/mpeg").replace(/no/,"")||e.canPlayType('audio/ogg;codecs="vorbis"').replace(/no/,"")))}catch(q){}f.Sound=h("../vendor/sound/sound").Sound;f.Sound.initialize({swfLocation:k+"SoundMain.swf",forceFlash:d});var F=h("./twilio/device").Device,g=h("../vendor/mediastream/mediastream").MediaStream;
F.__afterSetup(function(d,b){if(!h("./twilio/rtc").enabled()){var e=a.decode;g.initialize({objectEnc:g.AMF0,swfLocation:function(a,d){if(!a)return d;var b=d.match(/^(\w+):\/\/([^/]*)(.*)?/);if(!b)return d;var c=b[1],q=b[2],b=b[3];if(!/twilio.com$/.test(q.split(":")[0]))return d;var k=e(a).iss;return k?c+"://"+k.toLowerCase()+"."+q+b:d}(d,k)+"MediaStreamMain.swf",loader:function(a,d){F.dialog.insert(a,d)}})}});m||(b='twilio.js was loaded using an unsupported method. Please load twilio.js by including <script type="text/javascript" src="//static.twilio.com/libs/twiliojs/'+
b+'/twilio.min.js">\x3c/script>.',"undefined"!==typeof console&&("function"===typeof console.warn?console.warn(b):"function"===typeof console.log&&console.log(b)));b=h("./twilio");b.Sound=f.Sound;b.MediaStream=g;return b}());return f}("undefined"!==typeof Twilio?Twilio:null)},{"../vendor/mediastream/mediastream":31,"../vendor/sound/sound":32,"./twilio":2,"./twilio/device":4,"./twilio/rtc":14,"./twilio/util":19}],2:[function(h,n,l){l.Device=h("./twilio/device").Device;l.EventStream=h("./twilio/eventstream").EventStream;
l.PStream=h("./twilio/pstream").PStream;l.Connection=h("./twilio/connection").Connection;var a=h("./twilio/util");l.require=function(g){switch(g){case "twilio/rtc":return"undefined"!==typeof console&&("function"===typeof console.error?console.error("Twilio.require() is a private function and will be removed!"):"function"===typeof console.warn?console.warn("Twilio.require() is a private function and will be removed!"):"function"===typeof console.log&&console.log("Twilio.require() is a private function and will be removed!")),
{enabled:function(){var a=l.Device;return a.getMediaEngine()===a.getMediaEngine.WEBRTC}};default:throw new a.Exception("Twilio.require() is a private function and will be removed!");}}},{"./twilio/connection":3,"./twilio/device":4,"./twilio/eventstream":6,"./twilio/pstream":13,"./twilio/util":19}],3:[function(h,n,l){function a(b,d,q){function F(){}if(!(this instanceof a))return new a(b,d,q);f.monitorEventEmitter("Twilio.Connection",this);this.device=b;this.message=d||{};q=q||{};b={logPrefix:"[Connection]",
mediaStreamFactory:k.PeerConnection,offerSdp:null,debug:!1,encrypt:!1,audioConstraints:b.options.audioConstraints};for(var m in b)m in q||(q[m]=b[m]);this.options=q;this.parameters={};this._status=this.options.offerSdp?"pending":"closed";this.sendHangup=!0;c.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.log.warnings=this.options.warnings;this._onHangup=this._onCancel=F;this._onAnswer=function(a){"undefined"!==typeof a.callsid&&(s.parameters.CallSid=a.callsid,s.mediaStream.callSid=
a.callsid)};this.mediaStream=new this.options.mediaStreamFactory(this.options.encrypt,this.device);var s=this;this.mediaStream.onerror=function(a){var d={code:a.info.code,message:a.info.message||"Error with mediastream",info:a.info,connection:s};s.log("Received an error from MediaStream:",a);s.emit("error",d)};this.mediaStream.onopen=function(){"connecting"==s._status?(s._status="open",s.mediaStream.attachAudio(),s.mediaStream.play("output"),s.emit("accept",s)):s.mediaStream.close()};this.mediaStream.onclose=
function(){s._status="closed";s.device.sounds.disconnect()&&s.device.soundcache.play("disconnect");s.emit("disconnect",s)};this.pstream=this.device.stream;this._onCancel=function(a){s.parameters.CallSid==a.callsid&&(s.cancel(),s.pstream.removeListener("cancel",s._onCancel))};this.pstream&&this.pstream.addListener("cancel",this._onCancel);this.on("error",function(){s.pstream&&"disconnected"===s.pstream.status&&g(s)});this.on("disconnect",function(){g(s)});return this}function g(a){function d(){a.pstream.removeListener("answer",
a._onAnswer);a.pstream.removeListener("cancel",a._onCancel);a.pstream.removeListener("hangup",a._onHangup)}d();setTimeout(d,0)}n=h("events").EventEmitter;var m=h("util"),f=h("./util"),c=h("./log"),b=h("./util").Exception,k=h("./rtc");m.inherits(a,n);a.toString=function(){return"[Twilio.Connection class]"};a.prototype.toString=function(){return"[Twilio.Connection instance]"};a.prototype.sendDigits=function(a){if(a.match(/[^0-9*#w]/))throw new b("Illegal character passed into sendDigits");for(var d=
[],c=0;c<a.length;c++){var k="w"!=a[c]?"dtmf"+a[c]:"";"dtmf*"==k&&(k="dtmfs");"dtmf#"==k&&(k="dtmfh");d.push([k,200,20])}this.device.soundcache.playseq(d);null!=this.pstream&&"disconnected"!=this.pstream.status?(a={dtmf:a,callsid:this.parameters.CallSid},this.pstream.publish("dtmf",a)):(a={error:{}},this.emit("error",{code:a.error.code||31E3,message:a.error.message||"Could not send DTMF: Signaling channel is disconnected",connection:this}))};a.prototype.status=function(){return this._status};a.prototype.mute=
function(a){0===arguments.length&&this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");if("function"==typeof a)return this.addListener("mute",a);var d=this.isMuted(),b=this,c=function(){var a=b.isMuted();d!=a&&b.emit("mute",a,b)};!1==a?this.mediaStream.attachAudio(c):this.mediaStream.detachAudio(c)};a.prototype.isMuted=function(){return!this.mediaStream.isAudioAttached()};a.prototype.unmute=function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");
this.mute(!1)};a.prototype.accept=function(a){if("function"==typeof a)return this.addListener("accept",a);a=a||this.options.audioConstraints;var d=this;this._status="connecting";this.mediaStream.openHelper(function(a,b){if("connecting"!=d._status)g(d),d.mediaStream.close();else if(a)d._die(a,b);else{var c=[],e;for(e in d.message)c.push(encodeURIComponent(e)+"="+encodeURIComponent(d.message[e]));c=c.join("&");d.parameters.CallSid?d.mediaStream.answerIncomingCall.call(d.mediaStream,d.parameters.CallSid,
d.options.offerSdp):(d.outboundConnectionId=f.generateConnectionUUID(),d.mediaStream.makeOutgoingCall.call(d.mediaStream,c,d.outboundConnectionId),d.pstream.once("answer",d._onAnswer));d._onHangup=function(a){if(a.callsid&&(d.parameters.CallSid||d.outboundConnectionId)){if(a.callsid!=d.parameters.CallSid&&a.callsid!=d.outboundConnectionId)return}else if(a.callsid)return;d.log("Received HANGUP from gateway");a.error&&(a={code:a.error.code||31E3,message:a.error.message||"Error sent from gateway in HANGUP",
connection:d},d.log("Received an error from the gateway:",a),d.emit("error",a));d.sendHangup=!1;d.disconnect();g(d)};d.pstream.addListener("hangup",d._onHangup)}},a)};a.prototype.reject=function(a){if("function"==typeof a)return this.addListener("reject",a);"pending"==this._status&&(this.pstream.publish("reject",{callsid:this.parameters.CallSid}),this.emit("reject"))};a.prototype.ignore=function(a){if("function"==typeof a)return this.addListener("cancel",a);"pending"==this._status&&(this._status=
"closed",this.emit("cancel"))};a.prototype.cancel=function(a){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead.");this.ignore(a)};a.prototype.disconnect=function(a){if("function"==typeof a)return this.addListener("disconnect",a);if("open"==this._status||"connecting"==this._status)this.log("Disconnecting..."),null!=this.pstream&&"disconnected"!=this.pstream.status&&this.sendHangup&&(a=this.parameters.CallSid||this.outboundConnectionId)&&this.pstream.publish("hangup",{callsid:a}),
g(this),this.mediaStream.close()};a.prototype.error=function(a){if("function"==typeof a)return this.addListener("error",a)};a.prototype._die=function(a,d){this.emit("error",{message:a,code:d})};l.Connection=a},{"./log":8,"./rtc":14,"./util":19,events:24,util:28}],4:[function(h,n,l){function a(y,g){if(!(this instanceof a))return new a(y,g);c.monitorEventEmitter("Twilio.Device",this);if(!y)throw new c.Exception("Capability token is not valid or missing.");var v={};for(i in g)v[i]=g[i];var m={logPrefix:"[Device]",
host:"chunder.twilio.com",chunderw:"chunderw-gll.twilio.com",soundCacheFactory:e,soundFactory:d,connectionFactory:q,pStreamFactory:F,presenceFactory:E,noRegister:!1,encrypt:!1,simplePermissionDialog:!1,rtc:!0,debug:!1,closeProtection:!1,secureSignaling:!0,warnings:!0,audioConstraints:!0};g=g||{};for(var x in m)x in g||(g[x]=m[x]);this.options=g;this.token=y;this._status="offline";this.connections=[];this.sounds=new k({incoming:!0,outgoing:!0,disconnect:!0});this.options.rtc||b.enabled(!1);if(!b.enabled())return new s(y,
v);this.soundcache=this.options.soundCacheFactory();v="undefined"===typeof document?{}:document.createElement("audio");canPlayMp3=!1;try{canPlayMp3=!(!v.canPlayType||!v.canPlayType("audio/mpeg").replace(/no/,""))}catch(h){}canPlayVorbis=!1;try{canPlayVorbis=!(!v.canPlayType||!v.canPlayType('audio/ogg;codecs="vorbis"').replace(/no/,""))}catch(l){}v="mp3";canPlayVorbis&&!canPlayMp3&&(v="ogg");var v={incoming:"sounds/incoming."+v,outgoing:"sounds/outgoing."+v,disconnect:"sounds/disconnect."+v,dtmf1:"sounds/dtmf-1."+
v,dtmf2:"sounds/dtmf-2."+v,dtmf3:"sounds/dtmf-3."+v,dtmf4:"sounds/dtmf-4."+v,dtmf5:"sounds/dtmf-5."+v,dtmf6:"sounds/dtmf-6."+v,dtmf7:"sounds/dtmf-7."+v,dtmf8:"sounds/dtmf-8."+v,dtmf9:"sounds/dtmf-9."+v,dtmf0:"sounds/dtmf-0."+v,dtmfs:"sounds/dtmf-star."+v,dtmfh:"sounds/dtmf-hash."+v},m=c.getTwilioRoot(),p;for(p in v)x=this.options.soundFactory(),x.load(m+v[p]),this.soundcache.add(p,x);this.soundcache.envelope("incoming",{release:2E3});f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;
var z=this;this.addListener("incoming",function(a){a.once("accept",function(){z.soundcache.stop("incoming")});a.once("cancel",function(){z.soundcache.stop("incoming")});a.once("error",function(){z.soundcache.stop("incoming")});a.once("reject",function(){z.soundcache.stop("incoming")});z.sounds.incoming()&&z.soundcache.play("incoming",0,1E3)});this.mediaPresence={audio:!this.options.noRegister};this.register(this.token);var r=this.options.closeProtection;r&&(p=function(a){if("busy"==z._status){var d=
!0==r?"A call is currently in-progress. Leaving or reloading this page will end the call.":r;return(a||window.event).returnValue=d}},"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("beforeunload",p):window.attachEvent&&window.attachEvent("onbeforeunload",p)));p=function(){z.disconnectAll()};"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("unload",p):window.attachEvent&&window.attachEvent("onunload",p));this.on("error",function(){});return this}
function g(a,d,b){var c={encrypt:a.options.encrypt,debug:a.options.debug,warnings:a.options.warnings};b=b||{};for(var q in c)q in b||(b[q]=c[q]);var e=a.options.connectionFactory(a,d,b);e.once("accept",function(){a._status="busy";a.emit("connect",e)});e.addListener("error",function(d){a.emit("error",d);"pending"==e.status()&&"connecting"==e.status()&&a._removeConnection(e)});e.once("cancel",function(){a.log("Canceled: "+e.parameters.CallSid);a._removeConnection(e);a.emit("cancel",e)});e.once("disconnect",
function(){"busy"==a._status&&(a._status="ready");a.emit("disconnect",e);a._removeConnection(e)});e.once("reject",function(){a.log("Rejected: "+e.parameters.CallSid);a._removeConnection(e)});return e}n=h("events").EventEmitter;var m=h("util"),f=h("./log"),c=h("./util"),b=h("./rtc"),k=h("./options").Options,e=h("./soundcache").SoundCache,d=h("../../vendor/sound/sound").Sound,q=h("./connection").Connection,F=h("./pstream").PStream,E=h("./presence").Presence,s=h("./olddevice").Device,x=h("./eventstream").EventStream,
z=h("../../vendor/mediastream/mediastream").MediaStream;m.inherits(a,n);c.mixinGetMediaEngine(a.prototype);a.toString=function(){return"[Twilio.Device class]"};a.prototype.toString=function(){return"[Twilio.Device instance]"};a.prototype.register=function(a){this.stream&&"disconnected"!=this.stream.status?this.stream.setToken(a):this._setupStream();this._setupEventStream(a)};a.prototype.registerPresence=function(){this.token&&(c.objectize(this.token).scope["client:incoming"]&&(this.mediaPresence.audio=
!0,this.eventStream||this._setupEventStream(this.token)),this._sendPresence())};a.prototype.unregisterPresence=function(){this.mediaPresence.audio=!1;this._sendPresence();this._disconnectEventStream()};a.prototype.presence=function(a){"client:incoming"in c.objectize(this.token).scope&&(this.presenceClient.handlers.push(a),this.token&&1==this.presenceClient.handlers.length&&this._setupEventStream(this.token))};a.prototype.showSettings=function(d){a.dialog.show(d||function(){});z.showSettings();a.dialog.screen.style.width=
"200%"};a.prototype.connect=function(a,d){if("function"==typeof a)return this.addListener("connect",a);a=a||{};d=d||this.options.audioConstraints;var b=g(this,a);this.connections.push(b);if(this.sounds.outgoing()){var c=this;b.accept(function(){c.soundcache.play("outgoing")})}b.accept(d);return b};a.prototype.disconnectAll=function(){for(var a=[].concat(this.connections),d=0;d<a.length;d++)a[d].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)};
a.prototype.destroy=function(){this.stream&&(this.stream.destroy(),this.stream=null);this._disconnectEventStream();this.swf&&this.swf.disconnect&&this.swf.disconnect()};a.prototype.disconnect=function(a){this.addListener("disconnect",a)};a.prototype.incoming=function(a){this.addListener("incoming",a)};a.prototype.offline=function(a){this.addListener("offline",a)};a.prototype.ready=function(a){this.addListener("ready",a)};a.prototype.error=function(a){this.addListener("error",a)};a.prototype.status=
function(){return this._status};a.prototype.activeConnection=function(){return this.connections[0]};a.prototype._sendPresence=function(){this.stream.register(this.mediaPresence);this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer()};a.prototype._startRegistrationTimer=function(){clearTimeout(this.regTimer);var a=this;this.regTimer=setTimeout(function(){a._sendPresence()},3E4)};a.prototype._stopRegistrationTimer=function(){clearTimeout(this.regTimer)};a.prototype._setupStream=
function(){var a=this;this.log("Setting up PStream");this.stream=this.options.pStreamFactory(this.token,{chunder:this.options.host,chunderw:this.options.chunderw,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.stream.addListener("connected",function(){a._sendPresence()});this.stream.addListener("ready",function(){a.log("Stream is ready");"offline"==a._status&&(a._status="ready");a.emit("ready",a)});this.stream.addListener("offline",function(){a.log("Stream is offline");
a._status="offline";a.emit("offline",a)});this.stream.addListener("error",function(d){var b=d.error;b&&(d.callsid&&(b.connection=a._findConnection(d.callsid)),a.log("Received error: ",b),a.emit("error",b))});this.stream.addListener("invite",function(d){if("busy"==a._status)a.log("Device busy; ignoring incoming invite");else if(d.callsid&&d.sdp){var b=g(a,{},{offerSdp:d.sdp});b.parameters=d.parameters||{};b.parameters.CallSid=b.parameters.CallSid||d.callsid;a.connections.push(b);a.emit("incoming",
b)}else a.emit("error",{message:"Malformed invite from gateway"})})};a.prototype._setupEventStream=function(a){this.options.eventStreamFactory=this.options.eventStreamFactory||x;this.options.eventsScheme=this.options.eventsScheme||"wss";this.options.eventsHost=this.options.eventsHost||"matrix.twilio.com";var d=[],b=null;"client:incoming"in c.objectize(a).scope&&(d.push("publishPresence"),this.presenceClient&&0<this.presenceClient.handlers.length&&d.push("presenceEvents"),b=function(a,d,b,e){e=e||
[];for(var q=[],k=0;k<e.length;k++)q.push("feature="+e[k]);e=["AccessToken="+a].concat(q);return[d+"://"+b,"2012-02-09",c.objectize(a).iss,c.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?"+e.join("&")}(a,this.options.eventsScheme,this.options.eventsHost,d));var e=this;b&&this.mediaPresence.audio?this.eventStream?(this.eventStream.options.url=b,this.eventStream.reconnect(a)):(this.log("Registering to eventStream with url: "+b),this.eventStream=new this.options.eventStreamFactory(a,
{logPrefix:"[Matrix]",debug:this.options.debug,url:b}),this.eventStream.addListener("error",function(a){e.log("Received error: ",a);e.emit("error",a)}),a=c.objectize(a).scope["client:incoming"].params.clientName,this.presenceClient=this.options.presenceFactory(a,this,this.eventStream,{autoStart:!0})):this._disconnectEventStream()};a.prototype._disconnectEventStream=function(){this.eventStream&&(this.eventStream.destroy(),this.presenceClient&&this.presenceClient.detach(this.eventStream),this.eventStream=
null);this.log("Destroyed eventstream.")};a.prototype._removeConnection=function(a){for(var d=this.connections.length-1;0<=d;d--)a==this.connections[d]&&this.connections.splice(d,1)};a.prototype._findConnection=function(a){for(var d=0;d<this.connections.length;d++){var b=this.connections[d];if(b.parameters.CallSid==a||b.outboundConnectionId==a)return b}};a=function(d){var b=[],e=[],q=function(a){if(d.instance)return a();e.push(a)},k=function(a){a=(a.code?a.code+": ":"")+a.message;if(d.instance){for(var b=
0,e=d.instance.listeners("error"),q=0;q<e.length;q++)e[q]!==k&&b++;if(1<b)return;d.instance.log(a)}throw new c.Exception(a);},f={instance:null,setup:function(c,q){if(d.instance)d.instance.log("Found existing Device; using new token but ignoring options"),d.instance.token=c,d.instance.register(c);else{d.instance=new a(c,q);d.error(k);d.sounds=d.instance.sounds;for(var f=0;f<e.length;f++)e[f]();e=[]}for(f=0;f<b.length;f++)b[f](c,q);b=[];return d},connect:function(a,b){if("function"==typeof a)q(function(){d.instance.addListener("connect",
a)});else{if(!d.instance)throw new c.Exception("Run Twilio.Device.setup()");if(0<d.instance.connections.length)d.instance.emit("error",{message:"A connection is currently active"});else return d.instance.connect(a,b)}},disconnectAll:function(){q(function(){d.instance.disconnectAll()});return d},disconnect:function(a){q(function(){d.instance.addListener("disconnect",a)});return d},status:function(){return d.instance._status},ready:function(a){q(function(){d.instance.addListener("ready",a)});return d},
error:function(a){q(function(){a!=k&&d.instance.removeListener("error",k);d.instance.addListener("error",a)});return d},presence:function(a){q(function(){d.instance.presence(a)});return d},offline:function(a){q(function(){d.instance.addListener("offline",a)});return d},incoming:function(a){q(function(){d.instance.addListener("incoming",a)});return d},destroy:function(){d.instance&&d.instance.destroy();return d},cancel:function(a){q(function(){d.instance.addListener("cancel",a)});return d},showPermissionsDialog:function(){if(!d.instance)throw new c.Exception("Run Twilio.Device.setup()");
d.instance.showSettings()},activeConnection:function(){return d.instance?d.instance.activeConnection():null},__afterSetup:function(a){b.push(a)}},g;for(g in f)d[g]=f[g];d.getMediaEngine=function(){return d.instance?d.instance.getMediaEngine():c.getMediaEngine()};d.getMediaEngine.FLASH=c.getMediaEngine.FLASH;d.getMediaEngine.WEBRTC=c.getMediaEngine.WEBRTC;return d}(a);a.dialog=s.dialog;l.Device=a},{"../../vendor/mediastream/mediastream":31,"../../vendor/sound/sound":32,"./connection":3,"./eventstream":6,
"./log":8,"./olddevice":10,"./options":11,"./presence":12,"./pstream":13,"./rtc":14,"./soundcache":17,"./util":19,events:24,util:28}],5:[function(h,n,l){function a(){if(!(this instanceof a))return new a;if("undefined"!==typeof document){var g=document.createElement("div"),m=document.createElement("div"),f=document.createElement("button");g.style.position="fixed";g.style.zIndex="99999";g.style.top="0";g.style.left="0";g.style.width="1px";g.style.height="1px";g.style.overflow="hidden";g.style.visibility=
"hidden";m.style.margin="10% auto 0";m.style.width="215px";m.style.borderRadius="8px";m.style.backgroundColor="#f8f8f8";m.style.border="8px solid rgb(160, 160, 160)";var c=this,b=function(){c.hide();c.closeCb&&c.closeCb.call()};f.appendChild(document.createTextNode("Close"));"undefined"!==typeof window&&(window.addEventListener?f.addEventListener("click",b,!1):f.attachEvent("onclick",b));g.appendChild(m);m.appendChild(f);this.screen=g;this.dialog=m;this.close=f;this.container=null;this.inserted=!1;
this.embed=function(){};document.body?(document.body.appendChild(g),c.inserted=!0):(c=this,m=function(){document.body.appendChild(g);c.inserted=!0;c.embed()},"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("load",m,!1):window.attachEvent("onload",m)))}}a.prototype.insert=function(a,m){if(this.container){if(this.container==a)return;this.dialog.removeChild(this.container)}this.container=a;this.dialog.insertBefore(a,this.close);this.embed=m||this.embed();this.inserted&&
this.embed()};a.prototype.show=function(a){if("undefined"!==typeof window&&"undefined"!==typeof document){this.close.style.display=a?"":"none";this.closeCb=a;this.screen.style.width="100%";this.screen.style.height="auto";this.screen.style.visibility="visible";a=this.dialog.style.width.replace("px","")|0;var m=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.dialog.style.marginLeft=(((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-
a)/2|0)+"px";this.dialog.style.marginTop=(0.1*m|0)+"px"}};a.prototype.hide=function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"};l.Dialog=a},{}],6:[function(h,n,l){function a(a,b){return function(){var c=Array.prototype.slice.call(arguments,0);if("function"==typeof c[0])return a.addListener(b,c[0]);c.unshift(b);return a.emit.apply(a,c)}}function g(a,b){var c;c="string"!=typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0==c.length?
[]:c.split("\n")}function m(d,e){if(!(this instanceof m))return new m(d,e);b.monitorEventEmitter("Twilio.EventStream",this);var f={logPrefix:"[EventStream]",scheme:"wss",host:"stream.twilio.com",reconnect:!0,url:null,flashTimeout:5E3,filters:{},debug:!1};e=e||{};for(var g in f)g in e||(e[g]=f[g]);this.options=e;this.token=d||"";this.handlers={};this.status="offline";c.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.heartbeat=new k({interval:15});this._connect();f="incoming ready offline sms call twiml error".split(" ");
for(g=0;g<f.length;g++)this[f[g]]=a(this,f[g]);var s=this;this.addListener("publish",function(a){s.emit("twiml",a)});this.on("error",function(){});return this}JSON="undefined"!==typeof JSON?JSON:h("../../vendor/json2");n=h("events").EventEmitter;var f=h("util"),c=h("./log"),b=h("./util"),k=h("./heartbeat").Heartbeat,e=h("../../vendor/web-socket-js/web_socket").WebSocket;f.inherits(m,n);m.initializingFlash=!1;m.initializeFlash=function(a){m.initializingFlash||(m.initializingFlash=!0,e&&e.__initialize&&
(WEB_SOCKET_SWF_LOCATION=a.options.swfLocation,e.__initialize(),a.log("Waiting "+a.options.flashTimeout+"ms for flash to initialize"),setTimeout(function(){e.__flash||a.log("WebSocket did not initialize")},a.options.flashTimeout)))};m.toString=function(){return"[Twilio.EventStream class]"};m.prototype.toString=function(){return"[Twilio.EventStream instance]"};m.prototype.destroy=function(){this.socket.close();this.options.reconnect=!1;return this};m.prototype.publish=function(a,b){try{this.socket.send(JSON.stringify({"rt.message":"publish",
"rt.subchannel":b,"rt.payload":a}))}catch(c){this.log("Error while publishing to eventstream. Reconnecting socket."),this.socket&&this.socket.close(),this._tryReconnect()}};m.prototype._cleanupSocket=function(a){if(a){var b=function(){};a.onopen=function(){a.close()};a.onmessage=b;a.onerror=b;a.onclose=b;2>a.readyState&&a.close()}};m.prototype._connect=function(a){var b=this,c=this._extractUrl(),k=++a||1;if(c){var f=this.socket;this.log("Attempting to connect to "+c+"...");try{this.socket=new e(c)}catch(m){this.log("Connection to "+
c+" failed: "+(m.message||""));return}this.socket.onopen=function(){b.log("Socket opened... sending ready signal");b._cleanupSocket(f);b.socket.send(JSON.stringify({"rt.message":"listen","rt.token":b.token}))};this.socket.onerror=function(a){a.data?b.emit("error",{message:a.data.message||"",code:a.data.code||""}):b.log("Received message event:",a)};this.socket.onmessage=function(a){b.heartbeat.beat();if("\n"!=a.data){a=g(a.data);for(var d=0;d<a.length;d++){var e=JSON.parse(a[d]);if("ready"==e["rt.message"])"ready"!=
b.status&&(b.status="ready",b.emit("ready",b));else{var f=e["rt.message"]||e.EventType;if("error"==f){var m=e.message||"";b.log("Connection to "+c+" failed: "+m);/^4/.test(e.code)?b.options.reconnect=!1:5>k?(m=50*Math.pow(2,k),m=30+Math.round(Math.random()*m),setTimeout(function(){b.socket&&b.socket.close();b._connect(k)},m)):b.emit("error",{message:"Connection to Twilio failed: "+m,code:e.code||""})}"incoming"!=f&&b.emit("incoming",e);b.emit(f,e)}}}};this.socket.onclose=function(){b._cleanupSocket(f);
"offline"!=b.status&&(b.log("Gone offline"),b.status="offline",b.emit("offline",b))};this.heartbeat.onsleep=function(){b.log("Connection heartbeat timed out.");b.socket&&b.socket.close();b._tryReconnect(5E3)}}else this.log("Nothing to do")};m.prototype.reconnect=function(a){this.socket&&(0==this.socket.readyState?(socket=this.socket,socket.onopen=function(){socket.close()}):this.socket.close());this.token=a;this.options.reconnect=!0;this._tryReconnect()};m.prototype._extractUrl=function(){if(this.options.url)return this.options.url;
var a=b.objectize(this.token).scope;if(!("stream:subscribe"in a))return null;var a=a["stream:subscribe"],a=a.params&&a.params.path?a.params.path:"/",c=this.options.filters;c.AccessToken=this.token;return this.options.scheme+"://"+this.options.host+a+"?"+b.urlencode(c,!0)};m.prototype._tryReconnect=function(a){(new Date).getTime();if(this.options.reconnect&&null!=this._extractUrl()){a=a||5E3;this._connect();var b=function(b){return function(){b._tryReconnect(2*a)}}(this),c=function(e){return function(){switch(e.socket.readyState){case 0:setTimeout(c,
1E3);break;case 1:break;default:setTimeout(b,a)}}}(this);setTimeout(c,5E3)}};m=function(a){var b=[],c=function(c){if(a.instance)return c();b.push(c)},e={instance:null,status:"offline",setup:function(c,e){a.instance=new a(c,e);for(var k=0;k<b.length;k++)b[k]();a.ready(function(){a.status="ready"});a.offline(function(){a.status="offline"});return a},incoming:function(b){c(function(){a.instance.incoming(b)});return a},ready:function(b){c(function(){a.instance.ready(b)});return a},offline:function(b){c(function(){a.instance.offline(b)});
return a},sms:function(b){c(function(){a.instance.sms(b)});return a},call:function(b){c(function(){a.instance.call(b)});return a},twiml:function(b){c(function(){a.instance.twiml(b)});return a},error:function(b){c(function(){a.instance.error(b)});return a}},k;for(k in e)a[k]=e[k];return a}(m);l.EventStream=m},{"../../vendor/json2":30,"../../vendor/web-socket-js/web_socket":34,"./heartbeat":7,"./log":8,"./util":19,events:24,util:28}],7:[function(h,n,l){function a(g){if(!(this instanceof a))return new a(g);
g=g||{};var m=function(){},m={interval:10,now:function(){return(new Date).getTime()},repeat:function(a,b){return setInterval(a,b)},stop:function(a,b){return clearInterval(a,b)},onsleep:m,onwakeup:m},f;for(f in m)f in g||(g[f]=m[f]);this.interval=g.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=g.onsleep;this.onwakeup=g.onwakeup;this.repeat=g.repeat;this.stop=g.stop;this.now=g.now}a.toString=function(){return"[Twilio.Heartbeat class]"};a.prototype.toString=function(){return"[Twilio.Heartbeat instance]"};
a.prototype.beat=function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},1E3*this.interval)}};a.prototype.check=function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);this.pintvl=null}};a.prototype.sleeping=function(){return null==this.pintvl};l.Heartbeat=a},{}],8:[function(h,n,l){l.mixinLog=function(a,g){function m(){if(m.enabled)for(var a=
m.prefix?m.prefix+" ":"",c=0;c<arguments.length;c++){var b=arguments[c];m.handler("string"==typeof b?a+b:b)}}m.enabled=!0;m.prefix=g||"";m.defaultHandler=function(a){"undefined"!==typeof console&&console.log(a)};m.handler=m.defaultHandler;m.warnings=!0;m.defaultWarnHandler=function(a){"undefined"!==typeof console&&("function"===typeof console.warn?console.warn(a):"function"===typeof console.log&&console.log(a))};m.warnHandler=m.defaultWarnHandler;m.deprecated=function(){if(m.warnings)for(var a=0;a<
arguments.length;a++)m.warnHandler(arguments[a])};a.log=m}},{}],9:[function(h,n,l){function a(c,d,q){if(!(this instanceof a))return new a(c,d,q);m.monitorEventEmitter("Twilio.Connection",this);this.device=c;this.message=d||{};q=q||{};c={logPrefix:"[Connection]",bridgeToken:null,mediaStreamFactory:b.enabled()?b.PeerConnection:k,chunder:"chunder.prod.twilio.com",chunderw:"chunderw.prod.twilio.com",debug:!1,encrypt:!1,token:null};for(var g in c)g in q||(q[g]=c[g]);this.options=q;this.parameters={};this._status=
this.options.bridgeToken?"pending":"closed";f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.log.warnings=this.options.warnings;this.mediaStream=new this.options.mediaStreamFactory(this.options.encrypt,this.options[b.enabled()?"chunderw":"chunder"],this.device.options.simplePermissionDialog);var h=this;this.mediaStream.onerror=function(a){var b={code:a.info.code,message:a.info.message,info:a.info};h.log("Received an error from MediaStream:",a);h.emit("error",b)};this.mediaStream.onopen=
function(){h._status="open";h.mediaStream.attachAudio();h.mediaStream.play("output");h.emit("accept",h)};this.mediaStream.onclose=function(){h._status="closed";h.device.sounds.disconnect()&&h.device.soundcache.play("disconnect");h.emit("disconnect",h)};this.mediaStream.onCallSid=function(a){h.parameters.CallSid=a};this.on("error",function(){});return this}n=h("events").EventEmitter;var g=h("util"),m=h("./util"),f=h("./log"),c=h("./util").Exception,b=h("./rtc"),k=h("../../vendor/mediastream/mediastream").MediaStream;
g.inherits(a,n);a.toString=function(){return"[Twilio.Connection class]"};a.prototype.toString=function(){return"[Twilio.Connection instance]"};a.prototype.sendDigits=function(a){if(a.match(/[^0-9*#w]/))throw new c("Illegal character passed into sendDigits");this.mediaStream.exec("sendDTMF",a);for(var b=[],k=0;k<a.length;k++){var f="w"!=a[k]?"dtmf"+a[k]:"";"dtmf*"==f&&(f="dtmfs");"dtmf#"==f&&(f="dtmfh");b.push([f,200,20])}this.device.soundcache.playseq(b)};a.prototype.status=function(){return this._status};
a.prototype.mute=function(a){0===arguments.length&&this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");if("function"==typeof a)return this.addListener("mute",a);var b=this.isMuted(),c=this,k=function(){var a=c.isMuted();b!=a&&c.emit("mute",a,c)};!1==a?this.mediaStream.attachAudio(k):this.mediaStream.detachAudio(k)};a.prototype.isMuted=function(){return!this.mediaStream.isAudioAttached()};a.prototype.unmute=function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");
this.mute(!1)};a.prototype.accept=function(b){if("function"==typeof b)return this.addListener("accept",b);var d=this;this._status="pending";this.mediaStream.openHelper(function(a,b){if(a)d._die(a,b);else{var c=[],e;for(e in d.message)c.push(encodeURIComponent(e)+"="+encodeURIComponent(d.message[e]));c=[d.mediaStream.uri(),d.options.token,d.options.bridgeToken,c.join("&")].concat(d.options.acceptParams);c.push(m.getSDKVersion());d.mediaStream.open.apply(d.mediaStream,c)}},this.device.options.simplePermissionDialog,
a.NO_MIC_LEVEL||0,{showDialog:function(){Device.dialog.show()},closeDialog:function(a){Device.dialog.hide();d.device.options.simplePermissionDialog=a;a||(d._die("Access to microphone has been denied"),d.disconnect())}},function(a){d.device.showSettings(a)})};a.prototype.reject=function(a){if("function"==typeof a)return this.addListener("reject",a);this.device.stream.publish({Response:"reject",CallSid:this.parameters.CallSid},this.options.rejectChannel);this.emit("reject")};a.prototype.ignore=function(a){if("function"==
typeof a)return this.addListener("cancel",a);this._status="closed";this.emit("cancel")};a.prototype.cancel=function(a){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead.");this.ignore(a)};a.prototype.disconnect=function(a){if("function"==typeof a)return this.addListener("disconnect",a);"open"==this._status&&(this.log("Disconnecting..."),this.mediaStream.close())};a.prototype.error=function(a){if("function"==typeof a)return this.addListener("error",a)};a.prototype._die=function(a,
b){this.emit("error",{message:a,code:b})};l.Connection=a},{"../../vendor/mediastream/mediastream":31,"./log":8,"./rtc":14,"./util":19,events:24,util:28}],10:[function(h,n,l){function a(k,g){if(!(this instanceof a))return new a(k,g);f.monitorEventEmitter("Twilio.Device",this);if(!k)throw new f.Exception("Capability token is not valid or missing.");var h={logPrefix:"[Device]",host:"chunder.twilio.com",chunderw:"chunderw.twilio.com",soundCacheFactory:e,soundFactory:d,connectionFactory:q,eventStreamFactory:E,
presenceFactory:F,eventsScheme:"wss",eventsHost:"matrix.twilio.com",noRegister:!1,encrypt:!1,simplePermissionDialog:!1,rtc:!0,debug:!1,closeProtection:!1,warnings:!0};g=g||{};for(var s in h)s in g||(g[s]=h[s]);this.options=g;this.token=k;this._status="offline";this.connections=[];this.sounds=new b({incoming:!0,outgoing:!0,disconnect:!0});this.options.rtc||c.enabled(!1);this.soundcache=this.options.soundCacheFactory();h="undefined"===typeof document?{}:document.createElement("audio");canPlayMp3=!1;
try{canPlayMp3=!(!h.canPlayType||!h.canPlayType("audio/mpeg").replace(/no/,""))}catch(v){}canPlayVorbis=!1;try{canPlayVorbis=!(!h.canPlayType||!h.canPlayType('audio/ogg;codecs="vorbis"').replace(/no/,""))}catch(l){}h="mp3";canPlayVorbis&&!canPlayMp3&&(h="ogg");h={incoming:"sounds/incoming."+h,outgoing:"sounds/outgoing."+h,disconnect:"sounds/disconnect."+h,dtmf1:"sounds/dtmf-1."+h,dtmf2:"sounds/dtmf-2."+h,dtmf3:"sounds/dtmf-3."+h,dtmf4:"sounds/dtmf-4."+h,dtmf5:"sounds/dtmf-5."+h,dtmf6:"sounds/dtmf-6."+
h,dtmf7:"sounds/dtmf-7."+h,dtmf8:"sounds/dtmf-8."+h,dtmf9:"sounds/dtmf-9."+h,dtmf0:"sounds/dtmf-0."+h,dtmfs:"sounds/dtmf-star."+h,dtmfh:"sounds/dtmf-hash."+h};s=f.getTwilioRoot();for(var w in h){var A=this.options.soundFactory();A.load(s+h[w]);this.soundcache.add(w,A)}this.soundcache.envelope("incoming",{release:2E3});m.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;var n=this;this.addListener("incoming",function(a){a.addListener("accept",function(){n.soundcache.stop("incoming")});
a.addListener("cancel",function(){n.soundcache.stop("incoming")});a.addListener("error",function(){n.soundcache.stop("incoming")});n.sounds.incoming()&&n.soundcache.play("incoming",0,1E3)});this.register(this.token);var p=this.options.closeProtection;p&&(w=function(a){if("busy"==n._status){var b=!0==p?"A call is currently in-progress. Leaving or reloading this page will end the call.":p;return(a||window.event).returnValue=b}},addEventListener?addEventListener("beforeunload",w):attachEvent&&attachEvent("onbeforeunload",
w));w=function(){n.disconnectAll()};"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("unload",w):window.attachEvent&&window.attachEvent("onunload",w));this.on("error",function(){});return this}JSON="undefined"!==typeof JSON?JSON:h("../../vendor/json2");n=h("events").EventEmitter;var g=h("util"),m=h("./log"),f=h("./util"),c=h("./rtc"),b=h("./options").Options,k=h("./dialog").Dialog,e=h("./soundcache").SoundCache,d=h("../../vendor/sound/sound").Sound,q=h("./oldconnection").Connection;
h("./pstream");var F=h("./presence").Presence;h("./olddevice");var E=h("./eventstream").EventStream,s=h("../../vendor/mediastream/mediastream").MediaStream;g.inherits(a,n);f.mixinGetMediaEngine(a.prototype);a.toString=function(){return"[Twilio.Device class]"};a.prototype.toString=function(){return"[Twilio.Device instance]"};a.prototype.makeConnection=function(a,b,d,c,e){var k={acceptParams:[JSON.stringify(f.getSystemInfo()),f.objectize(a.token).iss],chunder:a.options.host,chunderw:a.options.chunderw,
encrypt:a.options.encrypt,debug:a.options.debug,warnings:a.options.warnings};e=e||{};for(var q in k)q in e||(e[q]=k[q]);"bridge"==d?(e.bridgeToken=b,e.token=null):"jwt"==d?(e.bridgeToken=null,e.token=b):this.log("Unknown token type: "+d);var g=a.options.connectionFactory(a,c,e);g.addListener("accept",function(){a._status="busy";a.emit("connect",g)});g.addListener("error",function(b){a.emit("error",b);if("pending"==g.status()){b=[].concat(a.connections);for(var d=0;d<b.length;d++)g==b[d]&&a.connections.splice(d,
1)}});g.addListener("cancel",function(){a.log("Canceled: "+g.parameters.CallSid);for(var b=[].concat(a.connections),d=0;d<b.length;d++)g==b[d]&&a.connections.splice(d,1);a.emit("cancel",g)});g.addListener("disconnect",function(){"busy"==a._status&&(a._status="ready");a.emit("disconnect",g);for(var b=[].concat(a.connections),d=0;d<b.length;d++)g==b[d]&&a.connections.splice(d,1)});return g};a.prototype.register=function(a){var b=[],d=null;"client:incoming"in f.objectize(a).scope&&(b.push("incomingCalls"),
b.push("publishPresence"),this.presenceClient&&0<this.presenceClient.handlers.length&&b.push("presenceEvents"),d=function(a,b,d,c){c=c||[];for(var e=[],k=0;k<c.length;k++)e.push("feature="+c[k]);c=["AccessToken="+a].concat(e);return[b+"://"+d,"2012-02-09",f.objectize(a).iss,f.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?"+c.join("&")}(a,this.options.eventsScheme,this.options.eventsHost,b));var c=this;!d||this.options.noRegister?(this.stream&&(this.stream.destroy(),this.presenceClient&&
this.presenceClient.detach(this.stream),this.stream=null),this.log("Unable to receive incoming calls"),"offline"==c._status&&(c._status="ready"),setTimeout(function(){c.emit("ready",c)},0)):this.stream?(this.stream.options.url=d,this.stream.reconnect(a)):(this.log("Registering to stream with url: "+d),this.stream=this.options.eventStreamFactory(a,{logPrefix:"[Matrix]",debug:this.options.debug,url:d}),this.stream.addListener("ready",function(){c.log("Stream is ready");"offline"==c._status&&(c._status=
"ready");c.emit("ready",c)}),this.stream.addListener("offline",function(){c.log("Stream is offline");c._status="offline";c.emit("offline",c)}),this.stream.addListener("error",function(a){c.log("Received error: ",a);c.emit("error",a)}),this.stream.addListener("incoming",function(a){c.log("Message incoming...",a);switch(a.Request){case "invite":if("busy"==c._status){c.log("Device busy; ignoring incoming invite");break}if(!a.Token||!a.CallSid){c.emit("error",{message:"Malformed invite"});break}var b=
a.Parameters||{};a=c.makeConnection(c,a.Token,"bridge",{},{rejectChannel:a.RejectChannel});a.parameters=b;c.connections.push(a);c.emit("incoming",a);break;case "cancel":for(var b=[].concat(c.connections),d=0;d<b.length;d++){var e=b[d];e.parameters.CallSid==a.CallSid&&"pending"==e.status()&&e.cancel()}}}),a=f.objectize(a).scope["client:incoming"].params.clientName,this.presenceClient=this.options.presenceFactory(a,this,this.stream,{autoStart:!0}))};a.prototype.presence=function(a){"client:incoming"in
f.objectize(this.token).scope&&(this.presenceClient.handlers.push(a),this.token&&1==this.presenceClient.handlers.length&&this.register(this.token))};a.prototype.showSettings=function(b){a.dialog.show(b||function(){});s.showSettings();a.dialog.screen.style.width="200%"};a.prototype.connect=function(a){if("function"==typeof a)return this.addListener("connect",a);a=a||{};a=this.makeConnection(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var b=this;a.accept(function(){b.soundcache.play("outgoing")})}a.accept();
return a};a.prototype.disconnectAll=function(a){if("function"==typeof a)return this.addListener("disconnectAll",a);a=[].concat(this.connections);for(var b=0;b<a.length;b++)a[b].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)};a.prototype.destroy=function(){this.stream.destroy();this.swf&&this.swf.disconnect&&this.swf.disconnect()};a.prototype.disconnect=function(a){this.addListener("disconnect",a)};a.prototype.incoming=function(a){this.addListener("incoming",
a)};a.prototype.offline=function(a){this.addListener("offline",a)};a.prototype.ready=function(a){this.addListener("ready",a)};a.prototype.error=function(a){this.addListener("error",a)};a.prototype.status=function(){return this._status};a.prototype.activeConnection=function(){return this.connections[0]};a.dialog=k();l.Device=a},{"../../vendor/json2":30,"../../vendor/mediastream/mediastream":31,"../../vendor/sound/sound":32,"./dialog":5,"./eventstream":6,"./log":8,"./oldconnection":9,"./olddevice":10,
"./options":11,"./presence":12,"./pstream":13,"./rtc":14,"./soundcache":17,"./util":19,events:24,util:28}],11:[function(h,n,l){h=function(){function a(m,f){if(!(this instanceof a))return new a(m);this.__dict__={};m=m||{};f=f||{};for(var c in m)this[c]=g(this.__dict__,c),this[c](m[c]);for(c in f)this[c](f[c])}function g(a,f){return function(c){return"undefined"==typeof c?a[f]:a[f]=c}}return a}();l.Options=h},{}],12:[function(h,n,l){var a=h("./util").Set,g=h("./util").bind,m=h("./options").Options,
f=h("./state"),c=300,b=0.2,k=function(a,b){return a+a*(2*Math.random()+-1)*b};h=function(){function e(k,s,l,n){if(!(this instanceof e))return new e(k,s,l,n);this.roster=new a;this.handlers=[];this.clientName=k;this.options=new m({autoStart:!1,interval:c,variation:b,clearTimeout:function(a){return clearTimeout(a)},setTimeout:function(a,b){return setTimeout(a,b)}},n);this._boundPresence=g(q,this);this._boundRoster=g(h,this);l.addListener("offline",g(this.handleOffline,this));this.attach(l);this._boundHeartbeat=
g(d,this,l,{ttl:2*this.options.interval(),availability:"available",keepalive:!0});k=new f.StateM({stop:"start",start:"stop"},this);this.start=k.doStart;this.stop=k.doStop;this.options.autoStart()&&this.start()}function d(a,b){a.publish(b,"presence")}function q(a){this[a.Available?"addToRoster":"removeFromRoster"](a.From)}function h(a){for(var b=0;b<a.Roster.length;b++)this.addToRoster(a.Roster[b])}e.prototype.enterStart=function(a,b){b={tid:null};var d=this;(function y(){var a=k(d.options.interval(),
d.options.variation());b.tid=d.options.setTimeout()(function(){d._boundHeartbeat();y()},1E3*a)})();return b};e.prototype.enterStop=function(a,b){this.options.clearTimeout()(b.tid)};e.prototype.heartbeat=d;e.prototype.attach=function(a){a.addListener("presence",this._boundPresence);a.addListener("roster",this._boundRoster)};e.prototype.detach=function(a){a.removeListener("presence",this._boundPresence);a.removeListener("roster",this._boundRoster)};e.prototype.removeFromRoster=function(a){this.roster.del(a);
this.invoke(a,!1)};e.prototype.addToRoster=function(a){this.roster.put(a);this.invoke(a,!0)};e.prototype.handleOffline=function(){var a=g(this.removeFromRoster,this);this.roster.map(a)};e.prototype.handlePresence=q;e.prototype.handleRoster=h;e.prototype.invoke=function(a,b){if(a!==this.clientName)for(var d={from:a,available:b},c=0;c<this.handlers.length;c++)this.handlers[c](d)};return e}();l.Presence=h},{"./options":11,"./state":18,"./util":19}],13:[function(h,n,l){function a(k,e){if(!(this instanceof
a))return new a(k,e);f.monitorEventEmitter("Twilio.PStream",this);var d={logPrefix:"[PStream]",chunder:"chunder.twilio.com",chunderw:"chunderw-gll.twilio.com",secureSignaling:!0,transportFactory:b,debug:!1};e=e||{};for(var q in d)q in e||(e[q]=d[q]);this.options=e;this.token=k||"";this.status="disconnected";this.host=c.enabled()?this.options.chunderw:this.options.chunder;m.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.on("error",function(){});var g=this;this.addListener("ready",
function(){g.status="ready"});this.addListener("offline",function(){g.status="offline"});this.addListener("close",function(){g.destroy()});this.transport=this.options.transportFactory({host:this.host,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.transport.onopen=function(){g.status="connected";g.setToken(g.token)};this.transport.onclose=function(){"disconnected"!=g.status&&("offline"!=g.status&&g.emit("offline",g),g.status="disconnected")};this.transport.onerror=function(a){g.emit("error",
a)};this.transport.onmessage=function(a){a=f.splitObjects(a.data);for(var b=0;b<a.length;b++){var d=JSON.parse(a[b]);g.emit(d.type,d.payload||{})}};this.transport.open();return this}JSON="undefined"!==typeof JSON?JSON:h("../../vendor/json2");n=h("events").EventEmitter;var g=h("util"),m=h("./log"),f=h("./util"),c=h("./rtc");h("./heartbeat");var b=h("./wstransport").WSTransport;g.inherits(a,n);a.toString=function(){return"[Twilio.PStream class]"};a.prototype.toString=function(){return"[Twilio.PStream instance]"};
a.prototype.setToken=function(a){this.log("Setting token and publishing listen");this.token=a;a={token:a,browserinfo:f.getSystemInfo()};this.publish("listen",a)};a.prototype.register=function(a){this.publish("register",{media:a})};a.prototype.destroy=function(){this.log("Closing PStream");this.transport.close();return this};a.prototype.publish=function(a,b){var d=JSON.stringify({type:a,version:f.getSDKVersion(),payload:b});this.transport.send(d)};l.PStream=a},{"../../vendor/json2":30,"./heartbeat":7,
"./log":8,"./rtc":14,"./util":19,"./wstransport":20,events:24,util:28}],14:[function(h,n,l){var a=h("./peerconnection");n.exports={PeerConnection:h("./peerconnection"),enabled:function(g){"undefined"!==typeof g&&(a.enabled=g);return a.enabled}}},{"./peerconnection":15}],15:[function(h,n,l){function a(b,c){if(!(this instanceof a))return new a(b,c);var e=function(){};this.onclose=this.onerror=this.onopen=e;this.version=null;this.pstream=c.stream;this.stream=null;this.video="undefined"!==typeof document&&
document.createElement("video");this.video.autoplay="autoplay";this.device=c;this.status="connecting";this._lastPublished=this._statistics=this._publishStatistics=this.callSid=null;this._onAnswer=e;return this}function g(a,k,e,d){var f;(f=!e)||(f=Number(new Date),null===a._lastPublished||a._lastPublished+c<=f?(a._lastPublished=f,f=!0):f=!1,f=!f);if(f)d&&(a._statistics=(a._statistics||[]).concat([d]));else{if(f=a._statistics)a._statistics=null,d=d?f.concat(d):f;else if(!d)return;k.publish("meta",{callsid:e,
quality:d})}}var m=h("../util"),f=h("./stats"),c=1E4;a.prototype.uri=function(){return this._uri};a.prototype.openHelper=function(b,c){var e=this;a.getUserMedia({audio:c},function(a){e.stream=a;b()},function(a){a.code==a.PERMISSION_DENIED?b("User denied access to microphone.",31208):b("Error occurred while accessing microphone.",31201)})};a.prototype._setupPeerConnection=function(){var b=a.protocol;b.create();b.pc.addStream(this.stream);var c=this;b.pc.onaddstream=function(a){"undefined"!==typeof c.video.srcObject?
c.video.srcObject=a.stream:"undefined"!==typeof c.video.mozSrcObject?c.video.mozSrcObject=a.stream:"undefined"!==typeof c.video.src?c.video.src=(window.URL||window.webkitURL).createObjectURL(a.stream):console.log("Error attaching stream to element.")};return b};a.prototype._setupChannel=function(){var a=this;a.version.pc.onopen=function(){a.status="open";a.onopen()};a.version.pc.onstatechange=function(c){a.version.pc&&"stable"==a.version.pc.readyState&&(a.status="open",a.onopen())};a.version.pc.onsignalingstatechange=
function(c){a.version.pc&&"stable"==a.version.pc.signalingState&&(a.status="open",a.onopen())};if("disconnected"!=a.pstream.status){var c=function(e){"closed"===a.status?a.pstream.removeListener("candidate",c):e.callsid==a.callSid&&a.version.processCandidate(e.candidate,e.label)};a.pstream.addListener("candidate",c)}};a.prototype._initializeMediaStream=function(){if("open"==this.status)return!1;if("disconnected"==this.pstream.status)return this.onerror({info:{code:31E3,message:"Cannot establish connection. Client is disconnected"}}),
this.close(),!1;this.version=this._setupPeerConnection();this._setupChannel();return!0};a.prototype.makeOutgoingCall=function(a,c){if(this._initializeMediaStream()){var e=this;this.callSid=c;var d=function(){},f=function(a){e.onerror({info:{code:31E3,message:"Error processing answer: "+(a.message||a)}})};this._onAnswer=function(a){"closed"!=e.status&&e.version.processAnswer(a.sdp,d,f)};this.pstream.once("answer",this._onAnswer);this.version.createOffer({audio:!0},function(){"closed"!=e.status&&(e.pstream.publish("invite",
{sdp:e.version.getSDP(),callsid:e.callSid,twilio:{accountsid:e.device.token?m.objectize(e.device.token).iss:null,params:a}}),e.startPublishingStatistics())},function(a){e.onerror({info:{code:31E3,message:"Error creating the offer: "+(a.message||a)}})})}};a.prototype.answerIncomingCall=function(a,c){if(this._initializeMediaStream()){this.callSid=a;var e=this;this.version.processSDP(c,{audio:!0},function(){"closed"!=e.status&&(e.pstream.publish("answer",{callsid:a,sdp:e.version.getSDP()}),e.startPublishingStatistics())},
function(a){e.onerror({info:{code:31E3,message:"Error creating the answer: "+(a.message||a)}})})}};a.prototype.close=function(){this.stopPublishingStatistics();this.version&&this.version.pc&&(this.version.pc.close(),this.version.pc=null);this.stream&&(this.stream.stop(),this.stream=null);this.pstream&&this.pstream.removeListener("answer",this._onAnswer);this.video.src="";this.status="closed";this.onclose()};a.prototype.play=function(){};a.prototype.publish=function(){};a.prototype.attachAudio=function(a){this.stream&&
((this.stream.audioTracks||this.stream.getAudioTracks())[0].enabled=!0);a&&"function"==typeof a&&a()};a.prototype.detachAudio=function(a){this.stream&&((this.stream.audioTracks||this.stream.getAudioTracks())[0].enabled=!1);a&&"function"==typeof a&&a()};a.prototype.isAudioAttached=function(){return this.stream?(this.stream.audioTracks||this.stream.getAudioTracks())[0].enabled:!1};a.prototype.stopPublishingStatistics=function(){clearInterval(this._publishStatistics);this._lastPublished=this._publishStatistics=
null;g(this,this.pstream,this.callSid,null);this._lastPublished=null};a.prototype.startPublishingStatistics=function(){this.stopPublishingStatistics();var a=this;this._publishStatistics=setInterval(function(){f(a.version.pc,function(c,e){c?a.stopPublishingStatistics():(e&&(e={timestamp:e.timestamp||Math.floor(new Date/1E3),packets:{recvlost:e.packetsLost,recvtot:e.packetsReceived,senttot:e.packetsSent},bytes:{recvtot:e.bytesReceived,senttot:e.bytesSent},jitter:e.jitter,rtt:e.rtt}),g(a,a.pstream,a.callSid,
e))})},1E3)};a.getUserMedia=function(a,c,e){"undefined"!=typeof navigator&&("function"==typeof navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(a,c,e):"function"==typeof navigator.mozGetUserMedia?navigator.mozGetUserMedia(a,c,e):console.log("No getUserMedia() implementation available"))};l=function(){"undefined"!=typeof window&&("function"==typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"==typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=
mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate):console.log("No RTCPeerConnection implementation available"))};l.prototype.create=function(){this.pc=new this.RTCPeerConnection({iceServers:[]})};l.prototype.createModernConstraints=function(a){if("undefined"===typeof a)return null;nc={mandatory:{}};"undefined"!==typeof a.audio&&(nc.mandatory.OfferToReceiveAudio=a.audio);"undefined"!==typeof a.video&&(nc.mandatory.OfferToReceiveVideo=a.video);return nc};
l.prototype.createOffer=function(a,c,e){var d=this,f=function(a){d.pc&&d.pc.setLocalDescription(new RTCSessionDescription(a),c,e)};try{this.pc.createOffer(f,e,a)}catch(g){this.pc.createOffer(f,e,this.createModernConstraints(a))}};l.prototype.createAnswer=function(a,c,e){var d=this,f=function(a){d.pc&&d.pc.setLocalDescription(new RTCSessionDescription(a),c,e)};try{this.pc.createAnswer(f,e,a)}catch(g){this.pc.createAnswer(f,e,this.createModernConstraints(a))}};l.prototype.processSDP=function(a,c,e,
d){var f=this;this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"offer"}),function(){f.createAnswer(c,e,d)},d)};l.prototype.getSDP=function(){return this.pc.localDescription.sdp};l.prototype.processAnswer=function(a,c,e){this.pc&&this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"answer"}),c,e)};l.prototype.processCandidate=function(a,c){if(this.pc)return this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,candidate:a}))};l.test=function(){if("object"==typeof navigator){if(navigator.webkitGetUserMedia&&
"function"==typeof window.webkitRTCPeerConnection)return!0;if(navigator.mozGetUserMedia&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!==typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(a){return!1}return!0}}};h=a;l=l.test()?new l:null;h.protocol=l;a.enabled=!!a.protocol;n.exports=a},{"../util":19,"./stats":16}],16:[function(h,n,l){function a(a,b){var k=[],m=[];a.result().forEach(function(a){var b=null;switch(a.type){case "googCandidatePair":a:{for(var b=
{},d={},c=a.names(),e=a.timestamp?Math.floor(a.timestamp/1E3):null,h=0;h<c.length;h++){var l=c[h],w=a.stat(l);switch(l){case "googActiveConnection":if("true"!==w){b=null;break a}break;case "googLocalAddress":b.localAddress=w;break;case "googRemoteAddress":b.remoteAddress=w;break;case "googRtt":b.rtt=Number(w);break;case "":break;default:d[l]=w}}b.timestamp=e;b=f(b,d)}break;case "ssrc":b=g(a);break;default:m.push(a)}b&&k.push(b)});if(0===k.length||0===(k=c(k)).length)return b(null,null);var h=k.reduceRight(function(a,
b){for(var d in b)a[d]=b[d];return a},{});b(null,h)}function g(a){var b={},c={},k=a.names(),g=a.timestamp?Math.floor(a.timestamp/1E3):null;k.forEach(function(f){var k=a.stat(f);switch(f){case "googCodecName":""!==k&&(b.codecName=k);break;case "googJitterBufferMs":b.googJitterBufferMs=Number(k);break;case "googJitterReceived":f=Number(k);-1!==f&&(b.jitter=f);break;case "bytesReceived":case "bytesSent":case "packetsReceived":case "packetsSent":case "timestamp":b[f]=Number(k);break;case "packetsLost":k=
Number(k);-1!==k&&(b[f]=k);break;default:c[f]=k}});b.timestamp=g;return f(b,c)}function m(a,b){var k=[],g=[];a.forEach(function(a){var b=null;switch(a.type){case "inboundrtp":var d={},b={},c;for(c in a){var e=a[c];switch(c){case "mozRtt":d.rtt=e;break;case "timestamp":d[c]=Math.floor(e/1E3);break;case "jitter":d[c]=1E3*e;break;case "bytesReceived":case "packetsLost":case "packetsReceived":d[c]=e;break;default:b[c]=e}}b=f(d,b);break;case "outboundrtp":if(!1===a.isRemote){c={};b={};for(d in a)switch(e=
a[d],d){case "timestamp":c[d]=Math.floor(e/1E3);case "bytesSent":case "packetsSent":c[d]=e;break;default:b[d]=e}b=f(c,b)}break;default:g.push(a)}b&&k.push(b)});if(0===k.length||0===(k=c(k)).length)return b(null,null);var m=k.reduceRight(function(a,b){for(var d in b)a[d]=b[d];return a},{});b(null,m)}function f(a,d){var c=null;b(a)||(c=c||{},c.known=a);b(d)||(c=c||{},c.unknown=d);return c}function c(a){for(var b=[],c=0;c<a.length;c++){var f=a[c];f.known&&b.push(f.known)}return b}function b(a){if(!a)return!0;
for(var b in a)return!1;return!0}function k(a,b){return function(){var c=Array.prototype.slice.call(arguments);c.push(b);return a.apply(null,c)}}n.exports=function(b,c){var f=Error("WebRTC statistics are unsupported");"undefined"===typeof navigator||"function"!==typeof b.getStats?c(f):navigator.webkitGetUserMedia?b.getStats(k(a,c),c):navigator.mozGetUserMedia?b.getStats(null,k(m,c),c):c(f)}},{}],17:[function(h,n,l){function a(a,f){return function(){var c=Array.prototype.slice(arguments);f.apply(a,
c)}}function g(){if(!(this instanceof g))return new g;this.cache={}}g.prototype.add=function(a,f,c){c=c||{};if(!(c instanceof Object))throw new TypeError("Bad envelope type; expected Object");f instanceof Array||(f=[f]);this.cache[a]={starttime:null,sounds:f,envelope:c}};g.prototype.play=function(a,f,c){f=f||0;c=c||1;if(a in this.cache){a=this.cache[a];for(var b=0;b<a.sounds.length;b++)a.sounds[b].play(f,c);a.starttime=(new Date).getTime()}};g.prototype.stop=function(a){if(a in this.cache){var f=
this.cache[a];a=f.envelope.release||0;var c=function(){for(var a=0;a<f.sounds.length;a++)f.sounds[a].stop()},b=(new Date).getTime(),b=Math.max(0,a-(b-f.starttime));0==a?c():setTimeout(c,b)}};g.prototype.envelope=function(a,f){if(a in this.cache){var c=this.cache[a],b;for(b in f)c.envelope[b]=f[b]}};g.prototype.playseq=function(){var g=null,f=[],c=function(){var b=f.shift();if(b){var k=b[0],e=b[1]||0,b=b[2]||0;k in this.cache&&this.play(k);g=setTimeout(a(this,c),e+b)}else g=null};return function(b){for(var k=
0;k<b.length;k++)f.push(b[k]);null==g&&(g=setTimeout(a(this,c),0))}}();l.SoundCache=g},{}],18:[function(h,n,l){var a,g,m,f,c={}.hasOwnProperty,b=function(a,b){function e(){this.constructor=a}for(var f in b)c.call(b,f)&&(a[f]=b[f]);e.prototype=b.prototype;a.prototype=new e;a.__super__=b.prototype;return a},k=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},e=[].slice;f=function(a){return a.substr(0,1).toUpperCase()+a.slice(1)};m=function(b){var c,
f,e;e=[];for(c in b)f=b[c],e.push(new a(c,f));return e};g=function(a){function c(){c.__super__.constructor.apply(this,arguments)}b(c,a);return c}(Error);a=function(){return function(a,b,c){this.froms=a;this.to=b;this.name=c;this.froms instanceof Array||(this.froms=[this.froms]);this.name=this.name||"do"+f(this.to)}}();h=function(){function a(b,c,d){var e;this.ctx=null!=c?c:this;this.stateData=null!=d?d:[];c=m(b);if(0===c.length)throw Error("Must initialize with at least one transition");this.state=
c[0].froms[0];this.stateData instanceof Array||(this.stateData=[this.stateData]);d=0;for(e=c.length;d<e;d++)b=c[d],this.makeEvent(b)}a.prototype.makeEvent=function(a){var b=this;return this[a.name]=function(){var c;if(c=b.state,0>k.call(a.froms,c))throw new g("Not a valid transition");b.stateData=b.invoke.apply(b,["leave",b.state,a].concat(e.call(b.stateData)));b.stateData=b.invoke.apply(b,["enter",a.to,a].concat(e.call(b.stateData)));return b.state=a.to}};a.prototype.invoke=function(){var a,b,c,
d,k;b=arguments[0];c=arguments[1];d=arguments[2];a=4<=arguments.length?e.call(arguments,3):[];b+=f(c);return this.ctx[b]?(a=(k=this.ctx)[b].apply(k,[d].concat(e.call(a))),"undefined"===typeof a&&(a=[]),a instanceof Array?a:[a]):a};return a}();l.TransitionError=g;l.Transition=a;l.StateM=h},{}],19:[function(h,n,l){(function(a){function g(a){if(!(this instanceof g))return new g(a);this.message=a}function m(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};return a.memo[b]?
a.memo[b]:a.memo[b]=a.apply(null,b)}}function f(a){a=a.split(".");if(3!=a.length)throw new g("Wrong number of segments");return s(a[1])}function c(a){if(""==a)return{};if(-1==a.indexOf("&")&&-1==a.indexOf("="))return a;a=a.split("&");for(var b={},d=0;d<a.length;d++){var e=a[d].split("=");b[decodeURIComponent(e[0])]=c(decodeURIComponent(e[1]))}return b}function b(b){try{return btoa(b)}catch(c){try{return(new a(b)).toString("base64")}catch(d){return F.encode(b)}}}function k(b){try{return atob(b)}catch(c){try{return(new a(b,
"base64")).toString("ascii")}catch(d){return F.decode(b)}}}function e(a){var b=[],c;for(c in a){var d="object"==typeof a[c]?e(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}return b.join("&")}function d(a){var b=h("./rtc");return(a?a.options.rtc:1)&&b.enabled()?d.WEBRTC:d.FLASH}var q=h("events").EventEmitter;JSON="undefined"!==typeof JSON?JSON:h("../../vendor/json2");var F=h("../../vendor/base64"),n=h("../../vendor/swfobject").swfobject;g.prototype.toString=function(){return"Twilio.Exception: "+
this.message};var s=m(function(a){var b=a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=k(a);return JSON.parse(a)}),x=m(function(a){a=f(a);for(var b=0===a.scope.length?[]:a.scope.split(" "),d={},e=0;e<b.length;e++){var k;k=b[e].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!k||4!=k.length)throw new g("Bad scope URI");k={service:k[1],privilege:k[2],params:c(k[3])};d[k.service+":"+k.privilege]=k}a.scope=d;return a}),z=function(){function a(){this.set={}}a.prototype.clear=
function(){this.set={}};a.prototype.put=function(b){return this.set[b]=a.DUMMY};a.prototype.del=function(a){return delete this.set[a]};a.prototype.map=function(a,b){var c=[],d;for(d in this.set)c.push(a.call(b,d));return c};a.DUMMY={};return a}(),y="",B=!1;d.FLASH="Flash";d.WEBRTC="WebRTC";l.getSDKVersion=function(){return"1.2"};l.encodescope=function(a,b,c){a=["scope",a,b].join(":");b=!0;for(var d in c){b=!1;break}return b?a:a+"?"+e(c)};l.dummyToken=function(a){var c={iss:"AC1111111111111111111111111111111",
exp:14E8},d;for(d in c)a[d]=a[d]||c[d];a=b(JSON.stringify(a));a=a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");return["*",a,"*"].join(".")};l.Exception=g;l.decode=f;l.btoa=b;l.atob=k;l.objectize=x;l.urlencode=function(a,b){var c=[];b=b||!1;for(var d in a)if(b&&a[d]instanceof Array)for(var e in a[d]){var f=a[d][e];c.push(encodeURIComponent(d)+"="+encodeURIComponent(f))}else f=a[d],c.push(encodeURIComponent(d)+"="+encodeURIComponent(f));return c.join("&")};l.Set=z;l.bind=function(a,b){var c=
Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return a.apply(b,c.concat(d))}};l.getSystemInfo=function(){var a=h("./rtc"),b="undefined"!=typeof navigator?navigator:{},b={p:"browser",v:"1.2",h:"ce7aa33",l:B,browser:{userAgent:b.userAgent||"unknown",platform:b.platform||"unknown"}};a.enabled()?b.plugin="rtc":(b.plugin="flash",b.flash={v:n.getFlashPlayerVersion()});return b};l.splitObjects=function(a,b){var c;c="string"!=typeof a?"":a.trim?a.trim():
a.replace(/^\s+|\s+$/g,"");return 0==c.length?[]:c.split("\n")};l.generateConnectionUUID=function(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};l.getTwilioRoot=function(){return y};l.setTwilioRoot=function(a){y=a};l.getLoaded=function(){return B};l.setLoaded=function(a){B=a};l.getMediaEngine=d;l.mixinGetMediaEngine=function(a){var b=d;a.getMediaEngine=function(){return b(this)};a.getMediaEngine.FLASH=d.FLASH;
a.getMediaEngine.WEBRTC=d.WEBRTC;return a};l.monitorEventEmitter=function(a,b){function c(e){var f=q.listenerCount(b,e);e="The number of "+e+" listeners on "+a+" exceeds the recommended number of "+d+". While twilio.js will continue to function normally, this may be indicative of an application error. Note that "+e+" listeners exist for the lifetime of the "+a+".";f>=d&&("undefined"!==typeof console&&(console.warn?console.warn(e):console.log&&console.log(e)),b.removeListener("newListener",c))}b.setMaxListeners(0);
var d=10;b.on("newListener",c)}}).call(this,h("buffer").Buffer)},{"../../vendor/base64":29,"../../vendor/json2":30,"../../vendor/swfobject":33,"./rtc":14,buffer:21,events:24}],20:[function(h,n,l){function a(c){var b=this instanceof a?this:new a(c);b.sock=null;var f=function(){};b.onopen=f;b.onclose=f;b.onmessage=f;b.onerror=f;f={logPrefix:"[WSTransport]",host:"chunderw-gll.twilio.com",reconnect:!0,debug:!1,secureSignaling:!0};c=c||{};for(var e in f)e in c||(c[e]=f[e]);b.options=c;m.mixinLog(b,b.options.logPrefix);
b.log.enabled=b.options.debug;b.defaultReconnect=b.options.reconnect;b.uri=(b.options.secureSignaling?"wss://":"ws://")+b.options.host+"/signal";return b}var g=h("./heartbeat").Heartbeat,m=h("./log"),f=h("../../vendor/web-socket-js/web_socket").WebSocket;a.prototype.msgQueue=[];a.prototype.open=function(a){this.log("Opening socket");this.sock&&2>this.sock.readyState?this.log("Socket already open."):(this.options.reconnect=this.defaultReconnect,this.heartbeat&&(this.heartbeat.onsleep=function(){}),
this.heartbeat=new g({interval:15}),this.sock=this._connect(a))};a.prototype.send=function(a){if(this.sock)if(0==this.sock.readyState)this.msgQueue.push(a);else try{this.sock.send(a)}catch(b){this.log("Error while sending. Closing socket: "+b.message),this.sock.close()}};a.prototype.close=function(){this.log("Closing socket");this.options.reconnect=!1;this.sock&&(this.sock.close(),this.sock=null);this.heartbeat.onsleep=function(){}};a.prototype._cleanupSocket=function(a){if(a){this.log("Cleaning up socket");
var b=function(){};a.onopen=function(){a.close()};a.onmessage=b;a.onerror=b;a.onclose=b;2>a.readyState&&a.close()}};a.prototype._connect=function(a){var b=++a||1;this.log("attempting to connect");var k=null;try{k=new f(this.uri)}catch(e){this.onerror({code:31E3,message:e.message||"Could not connect to "+this.uri});this.close();return}var d=this,g=this.sock,h=null,m=setTimeout(function(){d.log("connection attempt timed out");k.onclose=function(){};k.close();d.onclose();d._tryReconnect(b)},5E3);k.onopen=
function(){clearTimeout(m);d._cleanupSocket(g);h=(new Date).getTime();d.log("Socket opened");d.heartbeat.onsleep=function(){d.log("Heartbeat timed out. closing socket");d.sock.onclose=function(){};d.sock.close();d.onclose();d._tryReconnect(b)};d.heartbeat.beat();d.onopen();for(var a=0;a<d.msgQueue.length;a++)d.sock.send(d.msgQueue[a]);d.msgQueue=[]};k.onclose=function(){clearTimeout(m);d._cleanupSocket(g);d.heartbeat.onsleep=function(){};h&&10<((new Date).getTime()-h)/1E3&&(b=1);d.log("Socket closed");
d.onclose();d._tryReconnect(b)};k.onerror=function(a){d.log("Socket received error: "+a.message);d.onerror({code:31E3,message:a.message||"WSTransport socket error"})};k.onmessage=function(a){d.heartbeat.beat();if("\n"==a.data)d.send("\n");else d.onmessage(a)};return k};a.prototype._tryReconnect=function(a){a=a||0;if(this.options.reconnect){this.log("Attempting to reconnect.");var b=this,f=0;5>a?(f=50*Math.pow(2,a),f=30+Math.round(Math.random()*f)):f=3E3;setTimeout(function(){b.open(a)},f)}};l.WSTransport=
a},{"../../vendor/web-socket-js/web_socket":34,"./heartbeat":7,"./log":8}],21:[function(h,n,l){function a(b,c,d){if(!(this instanceof a))return new a(b,c,d);var f=typeof b,e;if("number"===f)e=0<b?b>>>0:0;else if("string"===f){if("base64"===c)for(b=(b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")).replace(K,"");0!==b.length%4;)b+="=";e=a.byteLength(b,c)}else if("object"===f&&null!==b)"Buffer"===b.type&&y(b.data)&&(b=b.data),e=0<+b.length?Math.floor(+b.length):0;else throw Error("First argument needs to be a number, array or string.");
var k;C?k=a._augment(new Uint8Array(e)):(k=this,k.length=e,k._isBuffer=!0);if(C&&"number"===typeof b.byteLength)k._set(b);else if(y(b)||a.isBuffer(b)||b&&"object"===typeof b&&"number"===typeof b.length)if(a.isBuffer(b))for(c=0;c<e;c++)k[c]=b.readUInt8(c);else for(c=0;c<e;c++)k[c]=(b[c]%256+256)%256;else if("string"===f)k.write(b,0,c);else if("number"===f&&!C&&!d)for(c=0;c<e;c++)k[c]=0;return k}function g(a,b,c,d){for(var e=[],f=0;f<b.length;f++)e.push(b.charCodeAt(f)&255);return v(e,a,c,d)}function m(a,
b,c){var d="";for(c=Math.min(a.length,c);b<c;b++)d+=String.fromCharCode(a[b]);return d}function f(a,b,c,d){d||(p("boolean"===typeof c,"missing or invalid endian"),p(void 0!==b&&null!==b,"missing offset"),p(b+1<a.length,"Trying to read beyond buffer length"));d=a.length;if(!(b>=d))return c?(c=a[b],b+1<d&&(c|=a[b+1]<<8)):(c=a[b]<<8,b+1<d&&(c|=a[b+1])),c}function c(a,b,c,d){d||(p("boolean"===typeof c,"missing or invalid endian"),p(void 0!==b&&null!==b,"missing offset"),p(b+3<a.length,"Trying to read beyond buffer length"));
d=a.length;if(!(b>=d)){var e;c?(b+2<d&&(e=a[b+2]<<16),b+1<d&&(e|=a[b+1]<<8),e|=a[b],b+3<d&&(e+=a[b+3]<<24>>>0)):(b+1<d&&(e=a[b+1]<<16),b+2<d&&(e|=a[b+2]<<8),b+3<d&&(e|=a[b+3]),e+=a[b]<<24>>>0);return e}}function b(a,b,c,d){d||(p("boolean"===typeof c,"missing or invalid endian"),p(void 0!==b&&null!==b,"missing offset"),p(b+1<a.length,"Trying to read beyond buffer length"));if(!(b>=a.length))return a=f(a,b,c,!0),a&32768?-1*(65535-a+1):a}function k(a,b,d,e){e||(p("boolean"===typeof d,"missing or invalid endian"),
p(void 0!==b&&null!==b,"missing offset"),p(b+3<a.length,"Trying to read beyond buffer length"));if(!(b>=a.length))return a=c(a,b,d,!0),a&2147483648?-1*(4294967295-a+1):a}function e(a,b,c,d){d||(p("boolean"===typeof c,"missing or invalid endian"),p(b+3<a.length,"Trying to read beyond buffer length"));return r.read(a,b,c,23,4)}function d(a,b,c,d){d||(p("boolean"===typeof c,"missing or invalid endian"),p(b+7<a.length,"Trying to read beyond buffer length"));return r.read(a,b,c,52,8)}function q(a,b,c,
d,e){e||(p(void 0!==b&&null!==b,"missing value"),p("boolean"===typeof d,"missing or invalid endian"),p(void 0!==c&&null!==c,"missing offset"),p(c+1<a.length,"trying to write beyond buffer length"),w(b,65535));var f=a.length;if(!(c>=f)){e=0;for(f=Math.min(f-c,2);e<f;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e);return c+2}}function F(a,b,c,d,e){e||(p(void 0!==b&&null!==b,"missing value"),p("boolean"===typeof d,"missing or invalid endian"),p(void 0!==c&&null!==c,"missing offset"),p(c+3<a.length,"trying to write beyond buffer length"),
w(b,4294967295));var f=a.length;if(!(c>=f)){e=0;for(f=Math.min(f-c,4);e<f;e++)a[c+e]=b>>>8*(d?e:3-e)&255;return c+4}}function E(a,b,c,d,e){e||(p(void 0!==b&&null!==b,"missing value"),p("boolean"===typeof d,"missing or invalid endian"),p(void 0!==c&&null!==c,"missing offset"),p(c+1<a.length,"Trying to write beyond buffer length"),A(b,32767,-32768));if(!(c>=a.length))return 0<=b?q(a,b,c,d,e):q(a,65535+b+1,c,d,e),c+2}function s(a,b,c,d,e){e||(p(void 0!==b&&null!==b,"missing value"),p("boolean"===typeof d,
"missing or invalid endian"),p(void 0!==c&&null!==c,"missing offset"),p(c+3<a.length,"Trying to write beyond buffer length"),A(b,2147483647,-2147483648));if(!(c>=a.length))return 0<=b?F(a,b,c,d,e):F(a,4294967295+b+1,c,d,e),c+4}function x(a,b,c,d,e){e||(p(void 0!==b&&null!==b,"missing value"),p("boolean"===typeof d,"missing or invalid endian"),p(void 0!==c&&null!==c,"missing offset"),p(c+3<a.length,"Trying to write beyond buffer length"),H(b,3.4028234663852886E38,-3.4028234663852886E38));if(!(c>=a.length))return r.write(a,
b,c,d,23,4),c+4}function z(a,b,c,d,e){e||(p(void 0!==b&&null!==b,"missing value"),p("boolean"===typeof d,"missing or invalid endian"),p(void 0!==c&&null!==c,"missing offset"),p(c+7<a.length,"Trying to write beyond buffer length"),H(b,1.7976931348623157E308,-1.7976931348623157E308));if(!(c>=a.length))return r.write(a,b,c,d,52,8),c+8}function y(a){return(Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)})(a)}function B(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);
if(127>=d)b.push(d);else{var e=c;55296<=d&&57343>=d&&c++;d=encodeURIComponent(a.slice(e,c+1)).substr(1).split("%");for(e=0;e<d.length;e++)b.push(parseInt(d[e],16))}}return b}function v(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function G(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}function w(a,b){p("number"===typeof a,"cannot write a non-number as a number");p(0<=a,"specified a negative value for writing an unsigned value");
p(a<=b,"value is larger than maximum value for type");p(Math.floor(a)===a,"value has a fractional component")}function A(a,b,c){p("number"===typeof a,"cannot write a non-number as a number");p(a<=b,"value larger than maximum allowed value");p(a>=c,"value smaller than minimum allowed value");p(Math.floor(a)===a,"value has a fractional component")}function H(a,b,c){p("number"===typeof a,"cannot write a non-number as a number");p(a<=b,"value larger than maximum allowed value");p(a>=c,"value smaller than minimum allowed value")}
function p(a,b){if(!a)throw Error(b||"Failed assertion");}var D=h("base64-js"),r=h("ieee754");l.Buffer=a;l.SlowBuffer=a;l.INSPECT_MAX_BYTES=50;a.poolSize=8192;var C=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);b.foo=function(){return 42};return 42===b.foo()&&"function"===typeof b.subarray&&0===(new Uint8Array(1)).subarray(1,1).byteLength}catch(c){return!1}}();a.isEncoding=function(a){switch(String(a).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "raw":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};a.isBuffer=function(a){return!(null==a||!a._isBuffer)};a.byteLength=function(a,b){var c;a=a.toString();switch(b||"utf8"){case "hex":c=a.length/2;break;case "utf8":case "utf-8":c=B(a).length;break;case "ascii":case "binary":case "raw":c=a.length;break;case "base64":c=D.toByteArray(a).length;break;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=2*a.length;break;default:throw Error("Unknown encoding");}return c};a.concat=function(b,c){p(y(b),"Usage: Buffer.concat(list[, length])");
if(0===b.length)return new a(0);if(1===b.length)return b[0];var d;if(void 0===c)for(d=c=0;d<b.length;d++)c+=b[d].length;var e=new a(c),f=0;for(d=0;d<b.length;d++){var k=b[d];k.copy(e,f);f+=k.length}return e};a.compare=function(b,c){p(a.isBuffer(b)&&a.isBuffer(c),"Arguments must be Buffers");for(var d=b.length,e=c.length,f=0,k=Math.min(d,e);f<k&&b[f]===c[f];f++);f!==k&&(d=b[f],e=c[f]);return d<e?-1:e<d?1:0};a.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var e=d;
d=b;b=c;c=e}b=Number(b)||0;e=this.length-b;c?(c=Number(c),c>e&&(c=e)):c=e;d=String(d||"utf8").toLowerCase();switch(d){case "hex":b=Number(b)||0;d=this.length-b;c?(c=Number(c),c>d&&(c=d)):c=d;d=a.length;p(0===d%2,"Invalid hex string");c>d/2&&(c=d/2);for(d=0;d<c;d++)e=parseInt(a.substr(2*d,2),16),p(!isNaN(e),"Invalid hex string"),this[b+d]=e;a=d;break;case "utf8":case "utf-8":a=v(B(a),this,b,c);break;case "ascii":a=g(this,a,b,c);break;case "binary":a=g(this,a,b,c);break;case "base64":a=v(D.toByteArray(a),
this,b,c);break;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":for(var f,e=[],k=0;k<a.length;k++)f=a.charCodeAt(k),d=f>>8,f%=256,e.push(f),e.push(d);a=v(e,this,b,c);break;default:throw Error("Unknown encoding");}return a};a.prototype.toString=function(a,b,c){a=String(a||"utf8").toLowerCase();b=Number(b)||0;c=void 0===c?this.length:Number(c);if(c===b)return"";switch(a){case "hex":a=b;b=this.length;if(!a||0>a)a=0;if(!c||0>c||c>b)c=b;for(b="";a<c;a++)b+=16>this[a]?"0"+this[a].toString(16):this[a].toString(16);
c=b;break;case "utf8":case "utf-8":var d=b;b=a="";for(c=Math.min(this.length,c);d<c;d++)127>=this[d]?(a+=G(b)+String.fromCharCode(this[d]),b=""):b+="%"+this[d].toString(16);c=a+G(b);break;case "ascii":c=m(this,b,c);break;case "binary":c=m(this,b,c);break;case "base64":a=b;c=0===a&&c===this.length?D.fromByteArray(this):D.fromByteArray(this.slice(a,c));break;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=this.slice(b,c);a="";for(b=0;b<c.length;b+=2)a+=String.fromCharCode(c[b]+256*c[b+1]);
c=a;break;default:throw Error("Unknown encoding");}return c};a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};a.prototype.equals=function(b){p(a.isBuffer(b),"Argument must be a Buffer");return 0===a.compare(this,b)};a.prototype.compare=function(b){p(a.isBuffer(b),"Argument must be a Buffer");return a.compare(this,b)};a.prototype.copy=function(a,b,c,d){c||(c=0);d||0===d||(d=this.length);b||(b=0);if(d!==c&&0!==a.length&&0!==this.length)if(p(d>=
c,"sourceEnd < sourceStart"),p(0<=b&&b<a.length,"targetStart out of bounds"),p(0<=c&&c<this.length,"sourceStart out of bounds"),p(0<=d&&d<=this.length,"sourceEnd out of bounds"),d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c),d-=c,100>d||!C)for(var e=0;e<d;e++)a[e+b]=this[e+c];else a._set(this.subarray(c,c+d),b)};a.prototype.slice=function(b,c){var d=this.length;b=~~b;c=void 0===c?d:~~c;0>b?(b+=d,0>b&&(b=0)):b>d&&(b=d);0>c?(c+=d,0>c&&(c=0)):c>d&&(c=d);c<b&&(c=b);if(C)return a._augment(this.subarray(b,
c));for(var d=c-b,e=new a(d,void 0,!0),f=0;f<d;f++)e[f]=this[f+b];return e};a.prototype.get=function(a){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(a)};a.prototype.set=function(a,b){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(a,b)};a.prototype.readUInt8=function(a,b){b||(p(void 0!==a&&null!==a,"missing offset"),p(a<this.length,"Trying to read beyond buffer length"));if(!(a>=this.length))return this[a]};
a.prototype.readUInt16LE=function(a,b){return f(this,a,!0,b)};a.prototype.readUInt16BE=function(a,b){return f(this,a,!1,b)};a.prototype.readUInt32LE=function(a,b){return c(this,a,!0,b)};a.prototype.readUInt32BE=function(a,b){return c(this,a,!1,b)};a.prototype.readInt8=function(a,b){b||(p(void 0!==a&&null!==a,"missing offset"),p(a<this.length,"Trying to read beyond buffer length"));if(!(a>=this.length))return this[a]&128?-1*(255-this[a]+1):this[a]};a.prototype.readInt16LE=function(a,c){return b(this,
a,!0,c)};a.prototype.readInt16BE=function(a,c){return b(this,a,!1,c)};a.prototype.readInt32LE=function(a,b){return k(this,a,!0,b)};a.prototype.readInt32BE=function(a,b){return k(this,a,!1,b)};a.prototype.readFloatLE=function(a,b){return e(this,a,!0,b)};a.prototype.readFloatBE=function(a,b){return e(this,a,!1,b)};a.prototype.readDoubleLE=function(a,b){return d(this,a,!0,b)};a.prototype.readDoubleBE=function(a,b){return d(this,a,!1,b)};a.prototype.writeUInt8=function(a,b,c){c||(p(void 0!==a&&null!==
a,"missing value"),p(void 0!==b&&null!==b,"missing offset"),p(b<this.length,"trying to write beyond buffer length"),w(a,255));if(!(b>=this.length))return this[b]=a,b+1};a.prototype.writeUInt16LE=function(a,b,c){return q(this,a,b,!0,c)};a.prototype.writeUInt16BE=function(a,b,c){return q(this,a,b,!1,c)};a.prototype.writeUInt32LE=function(a,b,c){return F(this,a,b,!0,c)};a.prototype.writeUInt32BE=function(a,b,c){return F(this,a,b,!1,c)};a.prototype.writeInt8=function(a,b,c){c||(p(void 0!==a&&null!==a,
"missing value"),p(void 0!==b&&null!==b,"missing offset"),p(b<this.length,"Trying to write beyond buffer length"),A(a,127,-128));if(!(b>=this.length))return 0<=a?this.writeUInt8(a,b,c):this.writeUInt8(255+a+1,b,c),b+1};a.prototype.writeInt16LE=function(a,b,c){return E(this,a,b,!0,c)};a.prototype.writeInt16BE=function(a,b,c){return E(this,a,b,!1,c)};a.prototype.writeInt32LE=function(a,b,c){return s(this,a,b,!0,c)};a.prototype.writeInt32BE=function(a,b,c){return s(this,a,b,!1,c)};a.prototype.writeFloatLE=
function(a,b,c){return x(this,a,b,!0,c)};a.prototype.writeFloatBE=function(a,b,c){return x(this,a,b,!1,c)};a.prototype.writeDoubleLE=function(a,b,c){return z(this,a,b,!0,c)};a.prototype.writeDoubleBE=function(a,b,c){return z(this,a,b,!1,c)};a.prototype.fill=function(a,b,c){a||(a=0);b||(b=0);c||(c=this.length);p(c>=b,"end < start");if(c!==b&&0!==this.length){p(0<=b&&b<this.length,"start out of bounds");p(0<=c&&c<=this.length,"end out of bounds");if("number"===typeof a)for(;b<c;b++)this[b]=a;else{a=
B(a.toString());for(var d=a.length;b<c;b++)this[b]=a[b%d]}return this}};a.prototype.inspect=function(){for(var a=[],b=this.length,c=0;c<b;c++)if(a[c]=16>this[c]?"0"+this[c].toString(16):this[c].toString(16),c===l.INSPECT_MAX_BYTES){a[c+1]="...";break}return"<Buffer "+a.join(" ")+">"};a.prototype.toArrayBuffer=function(){if("undefined"!==typeof Uint8Array){if(C)return(new a(this)).buffer;for(var b=new Uint8Array(this.length),c=0,d=b.length;c<d;c+=1)b[c]=this[c];return b.buffer}throw Error("Buffer.toArrayBuffer not supported in this browser");
};var u=a.prototype;a._augment=function(a){a._isBuffer=!0;a._get=a.get;a._set=a.set;a.get=u.get;a.set=u.set;a.write=u.write;a.toString=u.toString;a.toLocaleString=u.toString;a.toJSON=u.toJSON;a.equals=u.equals;a.compare=u.compare;a.copy=u.copy;a.slice=u.slice;a.readUInt8=u.readUInt8;a.readUInt16LE=u.readUInt16LE;a.readUInt16BE=u.readUInt16BE;a.readUInt32LE=u.readUInt32LE;a.readUInt32BE=u.readUInt32BE;a.readInt8=u.readInt8;a.readInt16LE=u.readInt16LE;a.readInt16BE=u.readInt16BE;a.readInt32LE=u.readInt32LE;
a.readInt32BE=u.readInt32BE;a.readFloatLE=u.readFloatLE;a.readFloatBE=u.readFloatBE;a.readDoubleLE=u.readDoubleLE;a.readDoubleBE=u.readDoubleBE;a.writeUInt8=u.writeUInt8;a.writeUInt16LE=u.writeUInt16LE;a.writeUInt16BE=u.writeUInt16BE;a.writeUInt32LE=u.writeUInt32LE;a.writeUInt32BE=u.writeUInt32BE;a.writeInt8=u.writeInt8;a.writeInt16LE=u.writeInt16LE;a.writeInt16BE=u.writeInt16BE;a.writeInt32LE=u.writeInt32LE;a.writeInt32BE=u.writeInt32BE;a.writeFloatLE=u.writeFloatLE;a.writeFloatBE=u.writeFloatBE;
a.writeDoubleLE=u.writeDoubleLE;a.writeDoubleBE=u.writeDoubleBE;a.fill=u.fill;a.inspect=u.inspect;a.toArrayBuffer=u.toArrayBuffer;return a};var K=/[^+\/0-9A-z]/g},{"base64-js":22,ieee754:23}],22:[function(h,n,l){(function(a){function g(a){a=a.charCodeAt(0);if(a===f)return 62;if(a===c)return 63;if(a<b)return-1;if(a<b+10)return a-b+52;if(a<e+26)return a-e;if(a<k+26)return a-k+26}var h="undefined"!==typeof Uint8Array?Uint8Array:Array,f=43,c=47,b=48,k=97,e=65;a.toByteArray=function(a){function b(a){l[n++]=
a}var c,e,f,k,l;if(0<a.length%4)throw Error("Invalid string. Length must be a multiple of 4");c=a.length;k="="===a.charAt(c-2)?2:"="===a.charAt(c-1)?1:0;l=new h(3*a.length/4-k);e=0<k?a.length-4:a.length;var n=0;for(c=0;c<e;c+=4)f=g(a.charAt(c))<<18|g(a.charAt(c+1))<<12|g(a.charAt(c+2))<<6|g(a.charAt(c+3)),b((f&16711680)>>16),b((f&65280)>>8),b(f&255);2===k?(f=g(a.charAt(c))<<2|g(a.charAt(c+1))>>4,b(f&255)):1===k&&(f=g(a.charAt(c))<<10|g(a.charAt(c+1))<<4|g(a.charAt(c+2))>>2,b(f>>8&255),b(f&255));return l};
a.fromByteArray=function(a){var b,c=a.length%3,e="",f,k;b=0;for(k=a.length-c;b<k;b+=3)f=(a[b]<<16)+(a[b+1]<<8)+a[b+2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f&63);switch(c){case 1:f=a[a.length-1];e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>
2);e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f<<4&63);e+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>10),e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>4&63),e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f<<2&63),e+="="}return e}})("undefined"===typeof l?this.base64js={}:l)},{}],23:[function(h,n,l){l.read=function(a,
g,h,f,c){var b;b=8*c-f-1;var k=(1<<b)-1,e=k>>1,d=-7;c=h?c-1:0;var l=h?-1:1,n=a[g+c];c+=l;h=n&(1<<-d)-1;n>>=-d;for(d+=b;0<d;h=256*h+a[g+c],c+=l,d-=8);b=h&(1<<-d)-1;h>>=-d;for(d+=f;0<d;b=256*b+a[g+c],c+=l,d-=8);if(0===h)h=1-e;else{if(h===k)return b?NaN:Infinity*(n?-1:1);b+=Math.pow(2,f);h-=e}return(n?-1:1)*b*Math.pow(2,h-f)};l.write=function(a,g,h,f,c,b){var k,e=8*b-c-1,d=(1<<e)-1,l=d>>1,n=23===c?Math.pow(2,-24)-Math.pow(2,-77):0;b=f?0:b-1;var E=f?1:-1,s=0>g||0===g&&0>1/g?1:0;g=Math.abs(g);isNaN(g)||
Infinity===g?(g=isNaN(g)?1:0,f=d):(f=Math.floor(Math.log(g)/Math.LN2),1>g*(k=Math.pow(2,-f))&&(f--,k*=2),g=1<=f+l?g+n/k:g+n*Math.pow(2,1-l),2<=g*k&&(f++,k/=2),f+l>=d?(g=0,f=d):1<=f+l?(g=(g*k-1)*Math.pow(2,c),f+=l):(g=g*Math.pow(2,l-1)*Math.pow(2,c),f=0));for(;8<=c;a[h+b]=g&255,b+=E,g/=256,c-=8);f=f<<c|g;for(e+=c;0<e;a[h+b]=f&255,b+=E,f/=256,e-=8);a[h+b-E]|=128*s}},{}],24:[function(h,n,l){function a(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function g(a){return"function"===
typeof a}function m(a){return"object"===typeof a&&null!==a}n.exports=a;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._maxListeners=void 0;a.defaultMaxListeners=10;a.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};a.prototype.emit=function(a){var c,b,k,e;this._events||(this._events={});if("error"===a&&(!this._events.error||m(this._events.error)&&!this._events.error.length)){c=arguments[1];
if(c instanceof Error)throw c;throw TypeError('Uncaught, unspecified "error" event.');}b=this._events[a];if(void 0===b)return!1;if(g(b))switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:c=arguments.length;k=Array(c-1);for(e=1;e<c;e++)k[e-1]=arguments[e];b.apply(this,k)}else if(m(b)){c=arguments.length;k=Array(c-1);for(e=1;e<c;e++)k[e-1]=arguments[e];b=b.slice();c=b.length;for(e=0;e<c;e++)b[e].apply(this,
k)}return!0};a.prototype.addListener=function(f,c){var b;if(!g(c))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",f,g(c.listener)?c.listener:c);this._events[f]?m(this._events[f])?this._events[f].push(c):this._events[f]=[this._events[f],c]:this._events[f]=c;m(this._events[f])&&!this._events[f].warned&&(b=void 0!==this._maxListeners?this._maxListeners:a.defaultMaxListeners)&&0<b&&this._events[f].length>b&&(this._events[f].warned=
!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[f].length),"function"===typeof console.trace&&console.trace());return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(a,c){function b(){this.removeListener(a,b);k||(k=!0,c.apply(this,arguments))}if(!g(c))throw TypeError("listener must be a function");var k=!1;b.listener=c;this.on(a,b);return this};a.prototype.removeListener=
function(a,c){var b,k,e;if(!g(c))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;b=this._events[a];e=b.length;k=-1;if(b===c||g(b.listener)&&b.listener===c)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,c);else if(m(b)){for(;0<e--;)if(b[e]===c||b[e].listener&&b[e].listener===c){k=e;break}if(0>k)return this;1===b.length?(b.length=0,delete this._events[a]):b.splice(k,1);this._events.removeListener&&this.emit("removeListener",
a,c)}return this};a.prototype.removeAllListeners=function(a){var c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(c in this._events)"removeListener"!==c&&this.removeAllListeners(c);this.removeAllListeners("removeListener");this._events={};return this}c=this._events[a];if(g(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);delete this._events[a];
return this};a.prototype.listeners=function(a){return this._events&&this._events[a]?g(this._events[a])?[this._events[a]]:this._events[a].slice():[]};a.listenerCount=function(a,c){return a._events&&a._events[c]?g(a._events[c])?1:a._events[c].length:0}},{}],25:[function(h,n,l){n.exports="function"===typeof Object.create?function(a,g){a.super_=g;a.prototype=Object.create(g.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,g){a.super_=g;var h=function(){};h.prototype=
g.prototype;a.prototype=new h;a.prototype.constructor=a}},{}],26:[function(h,n,l){function a(){}h=n.exports={};h.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(a){return window.setImmediate(a)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var a=[];window.addEventListener("message",function(h){var f=h.source;f!==window&&null!==f||"process-tick"!==h.data||(h.stopPropagation(),0<a.length&&a.shift()())},!0);return function(h){a.push(h);
window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}();h.title="browser";h.browser=!0;h.env={};h.argv=[];h.on=a;h.addListener=a;h.once=a;h.off=a;h.removeListener=a;h.removeAllListeners=a;h.emit=a;h.binding=function(a){throw Error("process.binding is not supported");};h.cwd=function(){return"/"};h.chdir=function(a){throw Error("process.chdir is not supported");}},{}],27:[function(h,n,l){n.exports=function(a){return a&&"object"===typeof a&&"function"===typeof a.copy&&"function"===
typeof a.fill&&"function"===typeof a.readUInt8}},{}],28:[function(h,n,l){(function(a,g){function m(a,b){var d={seen:[],stylize:c};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);x(b)?d.showHidden=b:b&&l._extend(d,b);B(d.showHidden)&&(d.showHidden=!1);B(d.depth)&&(d.depth=2);B(d.colors)&&(d.colors=!1);B(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=f);return k(d,a,d.depth)}function f(a,b){var c=m.styles[b];return c?"\u001b["+m.colors[c][0]+"m"+
a+"\u001b["+m.colors[c][1]+"m":a}function c(a,b){return a}function b(a){var b={};a.forEach(function(a,c){b[a]=!0});return b}function k(a,c,f){if(a.customInspect&&c&&H(c.inspect)&&c.inspect!==l.inspect&&(!c.constructor||c.constructor.prototype!==c)){var g=c.inspect(f,a);y(g)||(g=k(a,g,f));return g}if(g=e(a,c))return g;var h=Object.keys(c),m=b(h);a.showHidden&&(h=Object.getOwnPropertyNames(c));if(A(c)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return d(c);if(0===h.length){if(H(c))return a.stylize("[Function"+
(c.name?": "+c.name:"")+"]","special");if(v(c))return a.stylize(RegExp.prototype.toString.call(c),"regexp");if(w(c))return a.stylize(Date.prototype.toString.call(c),"date");if(A(c))return d(c)}var g="",p=!1,r=["{","}"];s(c)&&(p=!0,r=["[","]"]);H(c)&&(g=" [Function"+(c.name?": "+c.name:"")+"]");v(c)&&(g=" "+RegExp.prototype.toString.call(c));w(c)&&(g=" "+Date.prototype.toUTCString.call(c));A(c)&&(g=" "+d(c));if(0===h.length&&(!p||0==c.length))return r[0]+g+r[1];if(0>f)return v(c)?a.stylize(RegExp.prototype.toString.call(c),
"regexp"):a.stylize("[Object]","special");a.seen.push(c);h=p?q(a,c,f,m,h):h.map(function(b){return n(a,c,f,m,b,p)});a.seen.pop();return E(h,g,r)}function e(a,b){if(B(b))return a.stylize("undefined","undefined");if(y(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}if(z(b))return a.stylize(""+b,"number");if(x(b))return a.stylize(""+b,"boolean");if(null===b)return a.stylize("null","null")}function d(a){return"["+Error.prototype.toString.call(a)+
"]"}function q(a,b,c,d,e){for(var f=[],k=0,g=b.length;k<g;++k)Object.prototype.hasOwnProperty.call(b,String(k))?f.push(n(a,b,c,d,String(k),!0)):f.push("");e.forEach(function(e){e.match(/^\d+$/)||f.push(n(a,b,c,d,e,!0))});return f}function n(a,b,c,d,e,f){var g,h;b=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]};b.get?h=b.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.set&&(h=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(d,e)||(g="["+e+"]");h||
(0>a.seen.indexOf(b.value)?(h=null===c?k(a,b.value,null):k(a,b.value,c-1),-1<h.indexOf("\n")&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special"));if(B(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e);g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,
"string"))}return g+": "+h}function E(a,b,c){var d=0;return 60<a.reduce(function(a,b){d++;0<=b.indexOf("\n")&&d++;return a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function s(a){return Array.isArray(a)}function x(a){return"boolean"===typeof a}function z(a){return"number"===typeof a}function y(a){return"string"===typeof a}function B(a){return void 0===a}function v(a){return G(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}
function G(a){return"object"===typeof a&&null!==a}function w(a){return G(a)&&"[object Date]"===Object.prototype.toString.call(a)}function A(a){return G(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function H(a){return"function"===typeof a}function p(a){return 10>a?"0"+a.toString(10):a.toString(10)}function D(){var a=new Date,b=[p(a.getHours()),p(a.getMinutes()),p(a.getSeconds())].join(":");return[a.getDate(),K[a.getMonth()],b].join(" ")}var r=/%[sdj%]/g;l.format=
function(a){if(!y(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(m(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,e=d.length,b=String(a).replace(r,function(a){if("%%"===a)return"%";if(c>=e)return a;switch(a){case "%s":return String(d[c++]);case "%d":return Number(d[c++]);case "%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),f=d[c];c<e;f=d[++c])b=null!==f&&G(f)?b+(" "+m(f)):b+(" "+f);return b};l.deprecate=function(b,c){if(B(g.process))return function(){return l.deprecate(b,
c).apply(this,arguments)};if(!0===a.noDeprecation)return b;var d=!1;return function(){if(!d){if(a.throwDeprecation)throw Error(c);a.traceDeprecation?console.trace(c):console.error(c);d=!0}return b.apply(this,arguments)}};var C={},u;l.debuglog=function(b){B(u)&&(u=a.env.NODE_DEBUG||"");b=b.toUpperCase();if(!C[b])if(RegExp("\\b"+b+"\\b","i").test(u)){var c=a.pid;C[b]=function(){var a=l.format.apply(l,arguments);console.error("%s %d: %s",b,c,a)}}else C[b]=function(){};return C[b]};l.inspect=m;m.colors=
{bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};m.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};l.isArray=s;l.isBoolean=x;l.isNull=function(a){return null===a};l.isNullOrUndefined=function(a){return null==a};l.isNumber=z;l.isString=y;l.isSymbol=function(a){return"symbol"===typeof a};
l.isUndefined=B;l.isRegExp=v;l.isObject=G;l.isDate=w;l.isError=A;l.isFunction=H;l.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===typeof a};l.isBuffer=h("./support/isBuffer");var K="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");l.log=function(){console.log("%s - %s",D(),l.format.apply(l,arguments))};l.inherits=h("inherits");l._extend=function(a,b){if(!b||!G(b))return a;for(var c=Object.keys(b),
d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,h("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":27,_process:26,inherits:25}],29:[function(h,n,l){l.decode=function(a){var g,h,f,c,b,k=0,e=0;c="";var d=[];if(!a)return a;a+="";do g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),
c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),f=g<<18|h<<12|c<<6|b,g=f>>16&255,h=f>>8&255,f&=255,64==c?d[e++]=String.fromCharCode(g):64==b?d[e++]=String.fromCharCode(g,h):d[e++]=String.fromCharCode(g,h,f);while(k<a.length);c=d.join("");a=[];g=d=b=e=k=0;for(c+="";k<c.length;)b=c.charCodeAt(k),128>b?(a[e++]=String.fromCharCode(b),k++):191<b&&224>b?(d=c.charCodeAt(k+
1),a[e++]=String.fromCharCode((b&31)<<6|d&63),k+=2):(d=c.charCodeAt(k+1),g=c.charCodeAt(k+2),a[e++]=String.fromCharCode((b&15)<<12|(d&63)<<6|g&63),k+=3);return c=a.join("")};l.encode=function(a){var g,h,f,c,b=0,k=0,e="",e=[];if(!a)return a;a+="";if(null===a||"undefined"===typeof a)a="";else{a+="";g="";h=f=c=0;c=a.length;for(var d=0;d<c;d++){var l=a.charCodeAt(d),n=null;128>l?f++:n=127<l&&2048>l?String.fromCharCode(l>>6|192)+String.fromCharCode(l&63|128):String.fromCharCode(l>>12|224)+String.fromCharCode(l>>
6&63|128)+String.fromCharCode(l&63|128);null!==n&&(f>h&&(g+=a.slice(h,f)),g+=n,h=f=d+1)}f>h&&(g+=a.slice(h,c));a=g}do g=a.charCodeAt(b++),h=a.charCodeAt(b++),f=a.charCodeAt(b++),c=g<<16|h<<8|f,g=c>>18&63,h=c>>12&63,f=c>>6&63,c&=63,e[k++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c);
while(b<a.length);e=e.join("");switch(a.length%3){case 1:e=e.slice(0,-2)+"==";break;case 2:e=e.slice(0,-1)+"="}return e}},{}],30:[function(h,n,l){this.JSON||(JSON=function(){function a(a){return 10>a?"0"+a:a}function g(a,c){var b,k,e,d;b=/["\\\x00-\x1f\x7f-\x9f]/g;var l;switch(typeof a){case "string":return b.test(a)?'"'+a.replace(b,function(a){var b=h[a];if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+'"':'"'+a+'"';case "number":return isFinite(a)?
String(a):"null";case "boolean":case "null":return String(a);case "object":if(!a)return"null";if("function"===typeof a.toJSON)return g(a.toJSON());b=[];if("number"===typeof a.length&&!a.propertyIsEnumerable("length")){d=a.length;for(k=0;k<d;k+=1)b.push(g(a[k],c)||"null");return"["+b.join(",")+"]"}if(c)for(d=c.length,k=0;k<d;k+=1)e=c[k],"string"===typeof e&&(l=g(a[e],c))&&b.push(g(e)+":"+l);else for(e in a)"string"===typeof e&&(l=g(a[e],c))&&b.push(g(e)+":"+l);return"{"+b.join(",")+"}"}}Date.prototype.toJSON=
function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:g,parse:function(a,c){function b(a,d){var f,k;if(d&&"object"===typeof d)for(f in d)Object.prototype.hasOwnProperty.apply(d,[f])&&(k=b(f,d[f]),void 0!==k&&(d[f]=k));return c(a,d)}var k;if(/^[\],:{}\s]*$/.test(a.replace(/\\./g,
"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return k=eval("("+a+")"),"function"===typeof c?b("",k):k;throw new SyntaxError("parseJSON");}}}());n.exports=this.JSON||JSON},{}],31:[function(h,n,l){function a(b,c){if(!(this instanceof a))return new a(b,c);this.__id=a.__nextId++;var e=function(){};this.onconnected=this.onclose=this.onerror=this.onopen=e;this._uri=(b?"rtmps":"rtmp")+"://"+c+"/chunder";this.micAttached=!1;a.__instances[this.__id]=
this;return this}function g(a,c){if(document.body){var e=document.createElement("div");e.style.position="absolute";e.appendChild(a);document.body.appendChild(e);c()}else{e=function(){g(a,c)};try{window.addEventListener("load",e,!1)}catch(d){window.attachEvent("onload",e)}}}var m=h("../../lib/twilio/util"),f=h("../swfobject").swfobject;a.prototype={openHelper:function(b,c,e,d,f){var g=this;a.__queue(function(){a.getMicrophones().length==e?b("No microphone is available"):c?(a.isMicMuted()?(a.__queueResponseCB(function(a){d.closeDialog(a);
a&&(g.exec("startCall"),g.onopen(g))}),d.showDialog()):g.onconnected=function(){g.exec("startCall");g.onopen(g)},b()):(g.onconnected=function(){g.exec("startCall");g.onopen(g)},a.isMicMuted()?f(function(){a.isMicMuted()?b("User denied access to microphone.",31208):b()}):b())})},uri:function(){return this._uri},open:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.open.apply(a.__flash,[b.__id].concat(c))})},exec:function(){var b=this,c=Array.prototype.slice.call(arguments);
a.__queue(function(){a.__flash.exec.apply(a.__flash,[b.__id].concat(c))})},close:function(){var b=this;a.__queue(function(){a.__flash.close(b.__id)})},play:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.playStream.apply(a.__flash,[b.__id].concat(c))})},publish:function(b,c){var e=this;a.__queue(function(){a.__flash.publish(e.__id,b,c)})},attachAudio:function(b,c){var e=this;a.__queue(function(){a.__flash.attachAudio(e.__id,c);e.micAttached=!0;b&&"function"==
typeof b&&b()})},detachAudio:function(b){var c=this;a.__queue(function(){a.__flash.detachAudio(c.__id);c.micAttached=!1;b&&"function"==typeof b&&b()})},isAudioAttached:function(){return this.micAttached},__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,a);break;case "netStatus":this.__handleNetStatus(a);break;case "callsid":if("function"==typeof this.onCallSid)this.onCallSid(a.info.callsid)}},__handleNetStatus:function(b){a.log("Event info code: "+
b.info.code);switch(b.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":a.log("Connection failed or was rejected");this.onerror.call(this,b);break;case "NetConnection.Connect.Closed":a.log("Connection closed");this.onclose.call(this,b);break;case "NetConnection.Connect.Success":a.log("Connection established");this.publish("input","live");this.attachAudio();this.onconnected();break;default:a.log("Unexpected event: "+b.info.code)}}};h={__queue:function(b){a.initialized?
b():a.__tasks.push(b)},__queueResponseCB:function(b){a.__responseCB.push(b)},initialize:function(b){if(!f.hasFlashPlayerVersion("10.0.0"))throw new m.Exception("Flash Player >= 10.0.0 is required.");if(!a.__flash)if(b=b||{},b.swfLocation=b.swfLocation||"MediaStreamMain.swf",b.domId=b.domId||"__connectionFlash__",b.loader=b.loader||g,document.body){var c=document.createElement("div");c.id=b.domId;b.loader(c,function(){a.__flash=c;var d={};"objectEnc"in b&&(d.objectEnc=b.objectEnc);d.namespace="Twilio.MediaStream";
f.embedSWF(b.swfLocation,b.domId,"215","138","10.0.0",null,d,{hasPriority:!0,allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})})}else try{window.addEventListener("load",function(){a.initialize(b)},!1)}catch(e){window.attachEvent("onload",function(){a.initialize(b)})}},setMicrophoneGain:function(b){a.__queue(function(){try{a.__flash.setMicrophoneGain(b)}catch(c){a.log(c)}})},setMicrophone:function(b,c){a.__queue(function(){a.__flash.setMicrophone(b,c)})},
getMicrophone:function(){return a.initialized?a.__flash.getMicrophone():null},getMicrophones:function(){return a.initialized?a.__flash.getMicrophones():[]},setUseEchoSuppression:function(b){a.__queue(function(){try{a.__flash.setUseEchoSupression(b)}catch(c){a.log(c)}})},setSilenceLevel:function(b,c){a.__queue(function(){try{a.__flash.setSilenceLevel(b,c)}catch(e){a.log(e)}})},showSettings:function(){a.__queue(function(){a.__flash.showSettings()})},isMicMuted:function(){try{return a.__flash.isMicMuted()}catch(b){if(!(b instanceof
TypeError))throw b;}},log:function(b,c,e){if(a.__debug&&window.console&&(e=e||"log",console[e]("[MediaStream] "+b),"undefined"!=typeof c))console[e](c)}};n={__onFlashInitialized:function(){a.__flash=document.getElementById(a.__flash.id);setTimeout(function(){a.initialized=!0;a.__flash.setDebug(a.__debug);/Mac OS X.*Chrome\/2[34]/.test(navigator.userAgent)?a.setMicrophone(-1,!1):a.setMicrophone(-1,!0);var b=a.getMicrophone();a.log(b?"Using "+b:"No mics available");a.setMicrophoneGain(75);for(b=0;b<
a.__tasks.length;b++)a.__tasks[b].call()},0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var b=a.__flash.dequeueEvents(),c=0;c<b.length;c++)try{a.log("Received event: "+b[c].type),a.__instances[b[c].mediaStreamId].__handleEvent(b[c])}catch(e){a.log("Error while processing "+b[c].type+": "+e.message,e,"error")}},0)},__onLog:function(b){"error"==b.level?a.log(b.message,void 0,"error"):a.log(b.message)},__onUserResponse:function(b){for(var c=0;c<a.__responseCB.length;c++)a.__responseCB[c](b);
a.__responseCB=[]}};for(var c in h)a[c]=h[c];for(c in n)a[c]=n[c];a.__nextId=0;a.__flash=null;a.__instances={};a.__tasks=[];a.__responseCB=[];a.__debug=!1;a.initialized=!1;a.AMF0=0;a.AMF3=3;l.MediaStream=a},{"../../lib/twilio/util":19,"../swfobject":33}],32:[function(h,n,l){function a(b){if(!(this instanceof a))return new a(b);this.id=a.nextId++;a.items[this.id]=this;this.create();return this}var g=h("../swfobject").swfobject,m={create:function(){this.audio=document.createElement("audio");this.playing=
!1},buffer:function(){},play:function(a,b){if(!(this.playing||0>=b)){if(this.audio.currentTime!==a)try{if(this.audio.currentTime=a,this.audio.currentTime!==a)throw Error();}catch(c){var e=this.audio.src;this.audio.src="";this.audio.src=e}this.playing=!0;this.audio.play();var f=this;this.audio.addEventListener("ended",function z(){f.audio.removeEventListener("ended",z,!1);f.playing?(f.playing=!1,f.play(a,b-1)):f.playing=!1},!1)}},load:function(a){this.audio.src=a},stop:function(){this.playing=!1},
destroy:function(){this.audio.src="";delete this.audio}},f={create:function(){var b=this.id;a.queue(function(){a.flash.__create(b)})},buffer:function(b){var c=this.id;a.queue(function(){a.flash.__buffer(c,b)})},play:function(b,c){b=b||0;c=c||0;var e=this.id;a.queue(function(){a.flash.__play(e,b,c)})},load:function(b){var c=this.id;a.queue(function(){a.flash.__load(c,b)})},stop:function(){var b=this.id;a.queue(function(){a.flash.__stop(b)})},destroy:function(){var b=this.id;a.queue(function(){a.flash.__destroy(b);
delete a.items[b]})}},c={create:function(){},buffer:function(a){},play:function(a,b){},load:function(a){},stop:function(){},destroy:function(){}};if("undefined"===typeof window)for(var b in c)a.prototype[b]=c[b];var k={initializeFlash:function(b){b=b||{};b.swfLocation=b.swfLocation||"SoundMain.swf";b.domId=b.domId||"__soundFlash__";if(!a.flash)if(document.body){var c=document.createElement("div");c.id=b.domId;document.body.appendChild(c);a.flash=c;g.embedSWF(b.swfLocation,b.domId,"1","1","10.0.0",
null,{namespace:"Twilio.Sound"},{hasPriority:!0,allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){a.initializeFlash(b)},!1)}catch(e){window.attachEvent("onload",function(){a.initializeFlash(b)})}},log:function(b,c,e){if(a.debug&&window.console&&(e=e||"log",console[e]("[Sound] "+b),"undefined"!=typeof c))console[e](c)},queue:function(b){a.initialized?b():a.tasks.push(b)}},e={__onFlashInitialized:function(){a.initialized=
!0;a.flash=document.getElementById(a.flash.id);setTimeout(function(){a.flash.__setDebug(a.debug);a.log("Initialized and ready");for(var b=0;b<a.tasks.length;b++)a.tasks[b]()},0)},__onLog:function(b){a.log(b)}};a.nextId=0;a.debug=!1;a.tasks=[];a.items={};a.initialize=function(b){if(!b.forceFlash&&document.createElement("audio"))a.prototype=m;else if(g.hasFlashPlayerVersion("10.0.0")){a.prototype=f;for(var h in k)a[h]=k[h];for(h in e)a[h]=e[h];a.initializeFlash(b)}else a.prototype=c,"undefined"!=typeof console&&
(console.error||console.log||function(){})("WARNING: Audio sounds disabled. HTML5 audio support or Flash Player >= 10.0.0 is required")};l.Sound=a},{"../swfobject":33}],33:[function(h,n,l){if("undefined"!==typeof window){var a=function(){function g(){if(!L){try{var a=r.getElementsByTagName("body")[0].appendChild(r.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}L=!0;for(var a=K.length,c=0;c<a;c++)K[c]()}}function h(a){L?a():K[K.length]=a}function f(a){if(typeof D.addEventListener!=
w)D.addEventListener("load",a,!1);else if(typeof r.addEventListener!=w)r.addEventListener("load",a,!1);else if(typeof D.attachEvent!=w)z(D,"onload",a);else if("function"==typeof D.onload){var b=D.onload;D.onload=function(){b();a()}}else D.onload=a}function c(){var a=r.getElementsByTagName("body")[0],c=r.createElement(A);c.setAttribute("type",H);var d=a.appendChild(c);if(d){var e=0;(function(){if(typeof d.GetVariable!=w){var f=d.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),t.pv=[parseInt(f[0],
10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>e){e++;setTimeout(arguments.callee,10);return}a.removeChild(c);d=null;b()})()}else b()}function b(){var a=J.length;if(0<a)for(var b=0;b<a;b++){var c=J[b].id,f=J[b].callbackFn,g={success:!1,id:c};if(0<t.pv[0]){var h=x(c);if(h)if(!y(J[b].swfVersion)||t.wk&&312>t.wk)if(J[b].expressInstall&&e()){g={};g.data=J[b].expressInstall;g.width=h.getAttribute("width")||"0";g.height=h.getAttribute("height")||"0";h.getAttribute("class")&&(g.styleclass=h.getAttribute("class"));
h.getAttribute("align")&&(g.align=h.getAttribute("align"));for(var m={},h=h.getElementsByTagName("param"),p=h.length,n=0;n<p;n++)"movie"!=h[n].getAttribute("name").toLowerCase()&&(m[h[n].getAttribute("name")]=h[n].getAttribute("value"));d(g,m,c,f)}else l(h),f&&f(g);else v(c,!0),f&&(g.success=!0,g.ref=k(c),f(g))}else v(c,!0),f&&((c=k(c))&&typeof c.SetVariable!=w&&(g.success=!0,g.ref=c),f(g))}}function k(a){var b=null;(a=x(a))&&"OBJECT"==a.nodeName&&(typeof a.SetVariable!=w?b=a:(a=a.getElementsByTagName(A)[0])&&
(b=a));return b}function e(){return!Q&&y("6.0.65")&&(t.win||t.mac)&&!(t.wk&&312>t.wk)}function d(a,b,c,d){Q=!0;R=d||null;T={success:!1,id:c};var e=x(c);if(e){"OBJECT"==e.nodeName?(N=n(e),P=null):(N=e,P=c);a.id=p;if(typeof a.width==w||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==w||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";r.title=r.title.slice(0,47)+" - Flash Player Installation";d=t.ie&&t.win?"ActiveX":"PlugIn";d="MMredirectURL="+D.location.toString().replace(/&/g,
"%26")+"&MMplayerType="+d+"&MMdoctitle="+r.title;b.flashvars=typeof b.flashvars!=w?b.flashvars+("&"+d):d;t.ie&&t.win&&4!=e.readyState&&(d=r.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());E(a,b,c)}}function l(a){if(t.ie&&t.win&&4!=a.readyState){var b=r.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(n(a),b);a.style.display=
"none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(n(a),a)}function n(a){var b=r.createElement("div");if(t.win&&t.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(A)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)1==a[d].nodeType&&"PARAM"==a[d].nodeName||8==a[d].nodeType||b.appendChild(a[d].cloneNode(!0));return b}function E(a,b,c){var d,e=x(c);if(t.wk&&312>t.wk)return d;if(e)if(typeof a.id==w&&(a.id=c),
t.ie&&t.win){var f="",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";O[O.length]=a.id;d=x(a.id)}else{h=r.createElement(A);h.setAttribute("type",H);for(var k in a)a[k]!=Object.prototype[k]&&
("styleclass"==k.toLowerCase()?h.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&h.setAttribute(k,a[k]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&(a=h,g=f,k=b[f],c=r.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",k),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function s(a){var b=x(a);b&&"OBJECT"==b.nodeName&&(t.ie&&t.win?(b.style.display="none",function(){if(4==b.readyState){var c=x(a);if(c){for(var d in c)"function"==typeof c[d]&&
(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function x(a){var b=null;try{b=r.getElementById(a)}catch(c){}return b}function z(a,b,c){a.attachEvent(b,c);M[M.length]=[a,b,c]}function y(a){var b=t.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function B(a,b,c,d){if(!t.ie||!t.mac){var e=r.getElementsByTagName("head")[0];
e&&(c=c&&"string"==typeof c?c:"screen",d&&(S=I=null),I&&S==c||(d=r.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),I=e.appendChild(d),t.ie&&t.win&&typeof r.styleSheets!=w&&0<r.styleSheets.length&&(I=r.styleSheets[r.styleSheets.length-1]),S=c),t.ie&&t.win?I&&typeof I.addRule==A&&I.addRule(a,b):I&&typeof r.createTextNode!=w&&I.appendChild(r.createTextNode(a+" {"+b+"}")))}}function v(a,b){if(U){var c=b?"visible":"hidden";L&&x(a)?x(a).style.visibility=c:B("#"+a,"visibility:"+
c)}}function G(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=w?encodeURIComponent(a):a}var w="undefined",A="object",H="application/x-shockwave-flash",p="SWFObjectExprInst",D=window,r=document,C=navigator,u=!1,K=[function(){u?c():b()}],J=[],O=[],M=[],N,P,R,T,L=!1,Q=!1,I,S,U=!0,t=function(){var a=typeof r.getElementById!=w&&typeof r.getElementsByTagName!=w&&typeof r.createElement!=w,b=C.userAgent.toLowerCase(),c=C.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):
/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\v1",f=[0,0,0],g=null;if(typeof C.plugins!=w&&typeof C.plugins["Shockwave Flash"]==A)!(g=C.plugins["Shockwave Flash"].description)||typeof C.mimeTypes!=w&&C.mimeTypes[H]&&!C.mimeTypes[H].enabledPlugin||(u=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,
"$1"),10):0);else if(typeof D.ActiveXObject!=w)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");h&&(g=h.GetVariable("$version"))&&(e=!0,g=g.split(" ")[1].split(","),f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)])}catch(k){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();(function(){t.w3&&((typeof r.readyState!=w&&"complete"==r.readyState||typeof r.readyState==w&&(r.getElementsByTagName("body")[0]||r.body))&&g(),L||(typeof r.addEventListener!=w&&r.addEventListener("DOMContentLoaded",
g,!1),t.ie&&t.win&&(r.attachEvent("onreadystatechange",function(){"complete"==r.readyState&&(r.detachEvent("onreadystatechange",arguments.callee),g())}),D==top&&function(){if(!L){try{r.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}g()}}()),t.wk&&function(){L||(/loaded|complete/.test(r.readyState)?g():setTimeout(arguments.callee,0))}(),f(g)))})();(function(){t.ie&&t.win&&window.attachEvent("onunload",function(){for(var b=M.length,c=0;c<b;c++)M[c][0].detachEvent(M[c][1],
M[c][2]);b=O.length;for(c=0;c<b;c++)s(O[c]);for(var d in t)t[d]=null;t=null;for(var e in a)a[e]=null;a=null})})();return{registerObject:function(a,b,c,d){if(t.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;J[J.length]=e;v(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(t.w3)return k(a)},embedSWF:function(a,b,c,f,g,k,l,n,p,q){var r={success:!1,id:b};t.w3&&!(t.wk&&312>t.wk)&&a&&b&&c&&f&&g?(v(b,!1),h(function(){c+="";f+="";var h={};if(p&&typeof p===A)for(var m in p)h[m]=
p[m];h.data=a;h.width=c;h.height=f;m={};if(n&&typeof n===A)for(var s in n)m[s]=n[s];if(l&&typeof l===A)for(var t in l)m.flashvars=typeof m.flashvars!=w?m.flashvars+("&"+t+"="+l[t]):t+"="+l[t];if(y(g))s=E(h,m,b),h.id==b&&v(b,!0),r.success=!0,r.ref=s;else{if(k&&e()){h.data=k;d(h,m,b,q);return}v(b,!0)}q&&q(r)})):q&&q(r)},switchOffAutoHideShow:function(){U=!1},ua:t,getFlashPlayerVersion:function(){return{major:t.pv[0],minor:t.pv[1],release:t.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(a,b,c){if(t.w3)return E(a,
b,c)},showExpressInstall:function(a,b,c,f){t.w3&&e()&&d(a,b,c,f)},removeSWF:function(a){t.w3&&s(a)},createCSS:function(a,b,c,d){t.w3&&B(a,b,c,d)},addDomLoadEvent:h,addLoadEvent:f,getQueryParamValue:function(a){var b=r.location.search||r.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return G(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return G(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Q){var a=x(p);
a&&N&&(a.parentNode.replaceChild(N,a),P&&(v(P,!0),t.ie&&t.win&&(N.style.display="block")),R&&R(T));Q=!1}}}}();window.swfobject=a}else a={getFlashPlayerVersion:function(){}};l.swfobject=a},{}],34:[function(h,n,l){(function(a){var g=h("../swfobject").swfobject;if("undefined"!==typeof a&&"node"===a.title)var m=eval("require('ws')");l.WebSocket=function(){if(m)return m;if(window.WebSocket)return window.WebSocket;var a=window.console;a&&a.log&&a.error||(a={log:function(){},error:function(){}});if(g.hasFlashPlayerVersion("10.0.0"))return"file:"==
location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,f,e,d){var g=this;g.__id=WebSocket.__nextId++;WebSocket.__instances[g.__id]=g;g.readyState=WebSocket.CONNECTING;g.bufferedAmount=0;g.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(g.__id,a,b,f||null,e||0,d||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==
WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__addTask(function(){WebSocket.__flash.close(this.__id)}))},WebSocket.prototype.addEventListener=function(a,b,f){a in this.__events||(this.__events[a]=
[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b,f){if(a in this.__events)for(a=this.__events[a],f=a.length-1;0<=f;--f)if(a[f]===b){a.splice(f,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],f=0;f<b.length;++f)b[f](a);(b=this["on"+a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==
a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&
!window.opera){var f=document.createEvent("MessageEvent");f.initMessageEvent("message",!1,!1,b,null,null,window,null);return f}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(document.body)if(WebSocket.__swfLocation&&
(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var c=document.createElement("div");c.id="webSocketContainer";c.style.position="absolute";WebSocket.__isFlashLite()?(c.style.left="0px",c.style.top="0px"):(c.style.left="-100px",c.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";c.appendChild(b);document.body.appendChild(c);g.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,
allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}else a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");else window.addEventListener?window.addEventListener("load",WebSocket.__initialize,!1):window.attachEvent("onload",WebSocket.__initialize)},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);
WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var c=WebSocket.__flash.receiveEvents(),b=0;b<c.length;++b)WebSocket.__instances[c[b].webSocketId].__handleEvent(c[b])}catch(g){a.error(g)}},0);return!0},WebSocket.__log=function(c){a.log(decodeURIComponent(c))},WebSocket.__error=function(c){a.error(decodeURIComponent(c))},WebSocket.__addTask=
function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||WebSocket.__initialize(),WebSocket;a.error("Flash Player >= 10.0.0 is required.")}()}).call(this,h("_process"))},{"../swfobject":33,
_process:26}]},{},[1]);
